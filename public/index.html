<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üí∞ Aurababy Market</title>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@800&display=swap" rel="stylesheet">
    
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    
    <style>
/* ===================================
   GLOBAL STYLES
   =================================== */
* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
    font-family: 'Poppins', sans-serif;
    font-weight: 800;
}

body {
    overflow-x: hidden;
    background: #f5f5f5;
}

/* ===================================
   AUTHENTICATION STYLES
   =================================== */
#auth-container {
    display: flex;
    justify-content: center;
    align-items: center;
    min-height: 100vh;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    padding: 20px;
}

#auth-box {
    background: white;
    padding: 40px;
    border-radius: 20px;
    box-shadow: 0 10px 40px rgba(0,0,0,0.3);
    max-width: 450px;
    width: 100%;
}

.auth-title {
    text-align: center;
    color: #667eea;
    margin-bottom: 10px;
    font-size: 32px;
}

.auth-subtitle-small {
    text-align: center;
    color: #999;
    margin-bottom: 20px;
    font-size: 14px;
    font-weight: 600;
}

.auth-subtitle {
    text-align: center;
    color: #666;
    margin-bottom: 20px;
    font-size: 18px;
}

.auth-input {
    width: 100%;
    padding: 15px;
    margin: 10px 0;
    border: 2px solid #ddd;
    border-radius: 10px;
    font-size: 16px;
    transition: border 0.3s;
}

.auth-input:focus {
    outline: none;
    border-color: #667eea;
}

.auth-button {
    width: 100%;
    padding: 15px;
    margin: 10px 0;
    border: none;
    border-radius: 10px;
    font-size: 18px;
    cursor: pointer;
    transition: all 0.3s;
    color: white;
}

.auth-button:hover {
    transform: translateY(-2px);
    box-shadow: 0 5px 15px rgba(0,0,0,0.2);
}

.auth-button:active {
    transform: translateY(0);
}

.primary-button {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
}

.secondary-button {
    background: #95a5a6;
}

.guest-button {
    background: #34495e;
}

.error-message {
    color: #e74c3c;
    text-align: center;
    margin: 10px 0;
    font-size: 14px;
    font-weight: 600;
}

.success-message {
    color: #27ae60;
    text-align: center;
    margin: 10px 0;
    font-size: 14px;
    font-weight: 600;
}

/* ===================================
   LOADING SPINNER
   =================================== */
.loading {
    text-align: center;
    padding: 40px;
}

.loading-spinner {
    border: 4px solid #f3f3f3;
    border-top: 4px solid #667eea;
    border-radius: 50%;
    width: 50px;
    height: 50px;
    animation: spin 1s linear infinite;
    margin: 20px auto;
}

@keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
}

/* ===================================
   GAME CONTAINER
   =================================== */
#game-container {
    min-height: 100vh;
}

/* ===================================
   SIDEBAR
   =================================== */
.sidebar {
    width: 250px;
    min-height: 100vh;
    background: #2c3e50;
    color: white;
    padding: 20px;
    position: fixed;
    overflow-y: auto;
    z-index: 100;
}

.sidebar h2 {
    margin-bottom: 20px;
    font-size: 20px;
}

.sidebar-stats {
    margin-bottom: 30px;
    padding: 15px;
    background: #34495e;
    border-radius: 8px;
}

.sidebar-stats > div {
    margin-bottom: 10px;
    font-size: 14px;
}

.sidebar-stats strong {
    display: block;
    margin-bottom: 5px;
}

.sidebar-timer {
    font-size: 12px;
    color: #bdc3c7;
    padding-top: 10px;
    border-top: 1px solid #7f8c8d;
    margin-top: 10px;
}

.nav-button {
    width: 100%;
    padding: 12px;
    margin-bottom: 10px;
    background: #34495e;
    color: white;
    border: none;
    border-radius: 5px;
    cursor: pointer;
    font-size: 16px;
    font-family: 'Poppins', sans-serif;
    font-weight: 800;
    transition: all 0.2s;
}

.nav-button:hover {
    background: #2980b9;
    transform: translateX(5px);
}

.nav-button.active {
    background: #3498db;
}

.logout-button {
    background: #e74c3c;
    margin-top: 20px;
}

.logout-button:hover {
    background: #c0392b;
}

.sidebar-footer {
    font-size: 10px;
    color: #95a5a6;
    margin-top: 20px;
    text-align: center;
    font-weight: 600;
}

/* ===================================
   MAIN CONTENT
   =================================== */
.main-content {
    margin-left: 250px;
    padding: 20px;
    width: calc(100% - 250px);
}

.view-title {
    font-size: 32px;
    margin-bottom: 20px;
    color: #2c3e50;
}

.view-subtitle {
    font-size: 16px;
    color: #7f8c8d;
    margin-bottom: 20px;
    font-weight: 600;
}

/* ===================================
   CARDS & GRID
   =================================== */
.card-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
    gap: 20px;
    margin-top: 20px;
}

.card {
    border: 2px solid #ddd;
    border-radius: 10px;
    padding: 15px;
    background: white;
    cursor: pointer;
    transition: all 0.2s;
    position: relative;
}

.card:hover {
    transform: scale(1.05);
    box-shadow: 0 5px 15px rgba(0,0,0,0.2);
}

.card.price-changed {
    animation: priceFlash 1s ease-in-out;
}

@keyframes priceFlash {
    0%, 100% { background: white; }
    50% { background: #fffacd; }
}

.card img {
    width: 100%;
    height: 150px;
    object-fit: cover;
    border-radius: 8px;
}

.card h3 {
    margin: 10px 0;
    font-size: 18px;
    color: #2c3e50;
}

.card-price {
    font-size: 24px;
    font-weight: 800;
    margin: 10px 0;
}

.price-up {
    color: #27ae60;
}

.price-down {
    color: #e74c3c;
}

.price-change-badge {
    position: absolute;
    top: 10px;
    left: 10px;
    padding: 5px 10px;
    border-radius: 20px;
    font-size: 12px;
    font-weight: 800;
    color: white;
}

.price-change-up {
    background: #27ae60;
}

.price-change-down {
    background: #e74c3c;
}

.card-info {
    font-size: 14px;
    color: #7f8c8d;
    margin: 5px 0;
}

.card-button {
    width: 100%;
    padding: 12px;
    margin-top: 10px;
    border: none;
    border-radius: 8px;
    font-size: 16px;
    font-weight: 800;
    cursor: pointer;
    transition: all 0.2s;
}

.buy-button {
    background: #27ae60;
    color: white;
}

.buy-button:hover {
    background: #229954;
}

.buy-button:disabled {
    background: #bdc3c7;
    cursor: not-allowed;
}

.sell-button {
    background: #e74c3c;
    color: white;
}

.sell-button:hover {
    background: #c0392b;
}

/* ===================================
   LIMITED ITEMS
   =================================== */
.limited-card {
    border: 3px solid gold;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    position: relative;
}

.limited-card.rarity-common {
    border-color: #95a5a6;
    background: linear-gradient(135deg, #bdc3c7 0%, #95a5a6 100%);
}

.limited-card.rarity-rare {
    border-color: #3498db;
    background: linear-gradient(135deg, #5dade2 0%, #3498db 100%);
}

.limited-card.rarity-epic {
    border-color: #9b59b6;
    background: linear-gradient(135deg, #bb8fce 0%, #9b59b6 100%);
}

.limited-card.rarity-legendary {
    border-color: #f39c12;
    background: linear-gradient(135deg, #f7dc6f 0%, #f39c12 100%);
}

.limited-card.rarity-divine {
    border-color: #ff00ff;
    background: linear-gradient(135deg, #ff00ff 0%, #ff1493 50%, #00ffff 100%);
    animation: divine-glow 3s ease-in-out infinite;
}

@keyframes divine-glow {
    0%, 100% { box-shadow: 0 0 20px #ff00ff; }
    50% { box-shadow: 0 0 40px #00ffff; }
}

.limited-emoji {
    font-size: 80px;
    text-align: center;
    margin-bottom: 10px;
}

.limited-tier-badge {
    position: absolute;
    top: 10px;
    right: 10px;
    background: gold;
    color: black;
    padding: 5px 10px;
    border-radius: 20px;
    font-size: 12px;
    font-weight: 800;
}

.limited-tier-badge.rarity-common { background: #95a5a6; color: white; }
.limited-tier-badge.rarity-rare { background: #3498db; color: white; }
.limited-tier-badge.rarity-epic { background: #9b59b6; color: white; }
.limited-tier-badge.rarity-legendary { background: #f39c12; color: black; }
.limited-tier-badge.rarity-divine { background: linear-gradient(90deg, #ff00ff, #00ffff); color: white; }

.limited-info {
    background: rgba(0,0,0,0.3);
    padding: 15px;
    border-radius: 10px;
    margin: 15px 0;
}

.limited-serial {
    background: rgba(255,215,0,0.2);
    padding: 10px;
    border-radius: 8px;
    text-align: center;
    margin: 10px 0;
    border: 2px dashed gold;
}

/* ===================================
   TABS
   =================================== */
.tabs {
    display: flex;
    gap: 10px;
    margin: 20px 0;
    flex-wrap: wrap;
}

.tab-button {
    padding: 10px 20px;
    background: #95a5a6;
    color: white;
    border: none;
    border-radius: 5px;
    cursor: pointer;
    font-size: 16px;
    font-weight: 800;
    transition: all 0.2s;
}

.tab-button:hover {
    background: #7f8c8d;
}

.tab-button.active {
    background: #3498db;
}

/* ===================================
   TRADE HISTORY
   =================================== */
.trade-item {
    padding: 15px;
    margin-bottom: 10px;
    border-radius: 8px;
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.trade-buy {
    background: #cce5ff;
    border: 2px solid #007bff;
}

.trade-sell {
    background: #d4edda;
    border: 2px solid #28a745;
}

.trade-info {
    flex: 1;
}

.trade-price {
    font-size: 20px;
    font-weight: 800;
    text-align: right;
}

/* ===================================
   PROFILE PAGE
   =================================== */
.profile-header {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    padding: 40px;
    border-radius: 15px;
    color: white;
    margin-bottom: 30px;
    text-align: center;
}

.profile-username {
    font-size: 48px;
    margin-bottom: 10px;
}

.profile-joined {
    font-size: 14px;
    opacity: 0.8;
}

.stats-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 20px;
    margin-bottom: 30px;
}

.stat-card {
    background: white;
    padding: 25px;
    border-radius: 10px;
    box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    border-left: 5px solid #3498db;
}

.stat-label {
    font-size: 14px;
    color: #7f8c8d;
    margin-bottom: 10px;
}

.stat-value {
    font-size: 36px;
    font-weight: 800;
    color: #2c3e50;
}

.chart-container {
    background: white;
    padding: 30px;
    border-radius: 15px;
    margin-bottom: 30px;
    box-shadow: 0 2px 10px rgba(0,0,0,0.1);
}

.chart-title {
    font-size: 24px;
    color: #2c3e50;
    margin-bottom: 20px;
}

/* ===================================
   LEADERBOARD
   =================================== */
.leaderboard-table {
    width: 100%;
    background: white;
    border-radius: 10px;
    overflow: hidden;
    box-shadow: 0 2px 10px rgba(0,0,0,0.1);
}

.leaderboard-table table {
    width: 100%;
    border-collapse: collapse;
}

.leaderboard-table th {
    background: #3498db;
    color: white;
    padding: 15px;
    text-align: left;
    font-size: 16px;
}

.leaderboard-table td {
    padding: 12px 15px;
    border-bottom: 1px solid #ecf0f1;
}

.leaderboard-table tr:hover {
    background: #f8f9fa;
}

.leaderboard-rank {
    font-size: 20px;
    font-weight: 800;
    color: #3498db;
}

.leaderboard-highlight {
    background: #fff3cd !important;
    border-left: 4px solid #f39c12;
}

/* ===================================
   TRADING SYSTEM
   =================================== */
.trade-offer-card {
    background: white;
    border: 2px solid #3498db;
    border-radius: 10px;
    padding: 20px;
    margin-bottom: 15px;
}

.trade-offer-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 15px;
    padding-bottom: 15px;
    border-bottom: 2px solid #ecf0f1;
}

.trade-offer-content {
    display: grid;
    grid-template-columns: 1fr auto 1fr;
    gap: 20px;
    align-items: center;
    margin: 20px 0;
}

.trade-side {
    background: #f8f9fa;
    padding: 15px;
    border-radius: 8px;
}

.trade-arrow {
    font-size: 32px;
    color: #3498db;
}

.trade-item-list {
    margin-top: 10px;
}

.trade-item-entry {
    padding: 8px;
    margin: 5px 0;
    background: white;
    border-radius: 5px;
    font-size: 14px;
}

/* ===================================
   TRADE HUB
   =================================== */
.trade-ad-card {
    background: white;
    border: 2px solid #3498db;
    border-radius: 10px;
    padding: 20px;
    margin-bottom: 15px;
}

.trade-ad-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 15px;
}

.trade-ad-type {
    padding: 5px 15px;
    border-radius: 20px;
    font-size: 12px;
    color: white;
}

.trade-type-upgrade { background: #27ae60; }
.trade-type-downgrade { background: #e74c3c; }
.trade-type-lf { background: #9b59b6; }
.trade-type-selling { background: #f39c12; }

.trade-ad-content {
    background: #f8f9fa;
    padding: 15px;
    border-radius: 8px;
    margin: 10px 0;
}

.trade-ad-actions {
    display: flex;
    gap: 10px;
    margin-top: 15px;
}

.post-trade-form {
    background: white;
    padding: 25px;
    border-radius: 10px;
    margin-bottom: 30px;
    box-shadow: 0 2px 10px rgba(0,0,0,0.1);
}

.form-group {
    margin-bottom: 20px;
}

.form-label {
    display: block;
    margin-bottom: 8px;
    font-size: 14px;
    color: #2c3e50;
}

.form-input,
.form-select,
.form-textarea {
    width: 100%;
    padding: 12px;
    border: 2px solid #ddd;
    border-radius: 8px;
    font-size: 14px;
    font-family: 'Poppins', sans-serif;
    font-weight: 600;
}

.form-textarea {
    min-height: 100px;
    resize: vertical;
}

.form-button {
    padding: 12px 30px;
    background: #3498db;
    color: white;
    border: none;
    border-radius: 8px;
    cursor: pointer;
    font-size: 16px;
    font-weight: 800;
    transition: all 0.2s;
}

.form-button:hover {
    background: #2980b9;
}

/* ===================================
   MODAL
   =================================== */
.modal-overlay {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(0,0,0,0.7);
    display: flex;
    justify-content: center;
    align-items: center;
    z-index: 1000;
    overflow-y: auto;
}

.modal {
    background: white;
    padding: 30px;
    border-radius: 15px;
    max-width: 800px;
    width: 90%;
    max-height: 90vh;
    overflow-y: auto;
    margin: 20px;
}

.modal h2 {
    margin-bottom: 20px;
    color: #2c3e50;
}

.modal-buttons {
    display: flex;
    gap: 10px;
    margin-top: 20px;
}

.modal-button {
    flex: 1;
    padding: 15px;
    border: none;
    border-radius: 8px;
    font-size: 18px;
    font-weight: 800;
    cursor: pointer;
    transition: all 0.2s;
}

.modal-button-primary {
    background: #27ae60;
    color: white;
}

.modal-button-secondary {
    background: #e74c3c;
    color: white;
}

.modal-button-cancel {
    background: #95a5a6;
    color: white;
}

/* ===================================
   RESPONSIVE
   =================================== */
@media (max-width: 768px) {
    .sidebar {
        width: 100%;
        position: relative;
        min-height: auto;
    }
    
    .main-content {
        margin-left: 0;
        width: 100%;
    }
    
    .card-grid {
        grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
    }
    
    .trade-offer-content {
        grid-template-columns: 1fr;
    }
    
    .trade-arrow {
        transform: rotate(90deg);
    }
}

/* ===================================
   UTILITY CLASSES
   =================================== */
.text-center { text-align: center; }
.text-right { text-align: right; }
.text-success { color: #27ae60; }
.text-danger { color: #e74c3c; }
.text-warning { color: #f39c12; }
.text-info { color: #3498db; }
.text-muted { color: #7f8c8d; }

.mt-10 { margin-top: 10px; }
.mt-20 { margin-top: 20px; }
.mt-30 { margin-top: 30px; }
.mb-10 { margin-bottom: 10px; }
.mb-20 { margin-bottom: 20px; }
.mb-30 { margin-bottom: 30px; }

.flex { display: flex; }
.flex-center { display: flex; justify-content: center; align-items: center; }
.flex-between { display: flex; justify-content: space-between; align-items: center; }
.flex-gap-10 { gap: 10px; }
.flex-gap-20 { gap: 20px; }

.market-closed-banner {
    background: #e74c3c;
    color: white;
    padding: 15px;
    border-radius: 10px;
    text-align: center;
    margin-bottom: 20px;
    font-size: 18px;
}

.market-open-banner {
    background: #27ae60;
    color: white;
    padding: 15px;
    border-radius: 10px;
    text-align: center;
    margin-bottom: 20px;
    font-size: 18px;
}

.force-update-button {
    background: #e74c3c;
    color: white;
    padding: 15px 30px;
    border: none;
    border-radius: 10px;
    font-size: 18px;
    font-weight: 800;
    cursor: pointer;
    margin: 20px 0;
    animation: pulse 2s ease-in-out infinite;
}

.force-update-button:hover {
    background: #c0392b;
    transform: scale(1.05);
}

@keyframes pulse {
    0%, 100% { box-shadow: 0 0 0 0 rgba(231, 76, 60, 0.7); }
    50% { box-shadow: 0 0 20px 10px rgba(231, 76, 60, 0); }
}

.update-notice {
    background: #f39c12;
    color: white;
    padding: 20px;
    border-radius: 10px;
    text-align: center;
    margin: 20px 0;
    font-size: 18px;
    animation: slideDown 0.5s ease-out;
}

@keyframes slideDown {
    from { transform: translateY(-100px); opacity: 0; }
    to { transform: translateY(0); opacity: 1; }
}
    </style>
</head>
<body>
    <div id="auth-container">
        <div id="auth-box">
            <h1 class="auth-title">üí∞ Aurababy Market</h1>
            <p class="auth-subtitle-small">Multiplayer Trading Game</p>
            
            <div id="login-form">
                <h3 class="auth-subtitle">Welcome Back!</h3>
                <div id="login-error" class="error-message" style="display:none;"></div>
                <input type="text" id="login-username" class="auth-input" placeholder="Username">
                <input type="password" id="login-password" class="auth-input" placeholder="Password">
                <button onclick="loginUser()" class="auth-button primary-button">Login</button>
                <button onclick="showSignup()" class="auth-button secondary-button">Create Account</button>
                <button onclick="loginAnonymous()" class="auth-button guest-button">Play as Guest</button>
            </div>
            
            <div id="signup-form" style="display: none;">
                <h3 class="auth-subtitle">Create Your Account</h3>
                <div id="signup-error" class="error-message" style="display:none;"></div>
                <input type="text" id="signup-username" class="auth-input" placeholder="Username (3-20 characters)">
                <input type="password" id="signup-password" class="auth-input" placeholder="Password (min 6 characters)">
                <input type="password" id="signup-confirm" class="auth-input" placeholder="Confirm Password">
                <button onclick="signupUser()" class="auth-button primary-button">Create Account</button>
                <button onclick="showLogin()" class="auth-button secondary-button">Back to Login</button>
            </div>
            
            <div id="loading-screen" style="display: none;">
                <div class="loading">
                    <div class="loading-spinner"></div>
                    <h3>Loading your game...</h3>
                </div>
            </div>
        </div>
    </div>

    <div id="game-container" style="display: none;">
        <div id="root"></div>
    </div>

    <script>
    // Firebase Config
    const firebaseConfig = {
        apiKey: "AIzaSyBUXT3jdC1miTjbyG5dcuRdd8oSqzT4OMo",
        authDomain: "aurababymarket.firebaseapp.com",
        projectId: "aurababymarket",
        storageBucket: "aurababymarket.firebasestorage.app",
        messagingSenderId: "335246667462",
        appId: "1:335246667462:web:3b39c5bc78e05a674971c7",
        measurementId: "G-KSFT7RBPL3"
    };

    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.firestore();
    let currentUserAuth = null;
    console.log('Firebase initialized successfully!');

// ===================================
// AUTHENTICATION LOGIC
// ===================================

let userDocRef = null;
let gameStateLoaded = false;

// Global game state for Firebase saving
window.gameState = {
    username: 'Trader',
    money: 1000,
    portfolio: {},
    limitedInventory: {},
    limitedMintCounts: {},
    tradeHistory: [],
    highestMoney: 1000,
    highestNetWorth: 1000,
    priceHistory: [],
    createdAt: null
};

// ===================================
// AUTH UI FUNCTIONS
// ===================================

function showLogin() {
    document.getElementById('login-form').style.display = 'block';
    document.getElementById('signup-form').style.display = 'none';
    document.getElementById('login-error').style.display = 'none';
    document.getElementById('signup-error').style.display = 'none';
}

function showSignup() {
    document.getElementById('login-form').style.display = 'none';
    document.getElementById('signup-form').style.display = 'block';
    document.getElementById('login-error').style.display = 'none';
    document.getElementById('signup-error').style.display = 'none';
}

// ===================================
// LOGIN
// ===================================

async function loginUser() {
    const username = document.getElementById('login-username').value.trim().toLowerCase();
    const password = document.getElementById('login-password').value;
    const errorDiv = document.getElementById('login-error');
    
    if (!username || !password) {
        errorDiv.textContent = 'Please enter username and password';
        errorDiv.style.display = 'block';
        return;
    }
    
    if (username.length < 3 || username.length > 20) {
        errorDiv.textContent = 'Username must be 3-20 characters';
        errorDiv.style.display = 'block';
        return;
    }
    
    if (!/^[a-z0-9_]+$/.test(username)) {
        errorDiv.textContent = 'Username can only contain letters, numbers, and underscores';
        errorDiv.style.display = 'block';
        return;
    }
    
    try {
        errorDiv.style.display = 'none';
        const email = username + '@aurababymarket.app';
        await auth.signInWithEmailAndPassword(email, password);
    } catch (error) {
        if (error.code === 'auth/user-not-found') {
            errorDiv.textContent = 'Username not found. Please sign up first.';
        } else if (error.code === 'auth/wrong-password') {
            errorDiv.textContent = 'Incorrect password';
        } else {
            errorDiv.textContent = 'Login failed. Please try again.';
        }
        errorDiv.style.display = 'block';
    }
}

// ===================================
// SIGNUP
// ===================================

async function signupUser() {
    const username = document.getElementById('signup-username').value.trim().toLowerCase();
    const password = document.getElementById('signup-password').value;
    const confirmPassword = document.getElementById('signup-confirm').value;
    const errorDiv = document.getElementById('signup-error');
    
    if (!username) {
        errorDiv.textContent = 'Please enter a username';
        errorDiv.style.display = 'block';
        return;
    }
    
    if (username.length < 3 || username.length > 20) {
        errorDiv.textContent = 'Username must be 3-20 characters';
        errorDiv.style.display = 'block';
        return;
    }
    
    if (!/^[a-z0-9_]+$/.test(username)) {
        errorDiv.textContent = 'Username can only contain letters, numbers, and underscores';
        errorDiv.style.display = 'block';
        return;
    }
    
    const reserved = ['admin', 'moderator', 'system', 'guest', 'official', 'support'];
    if (reserved.includes(username)) {
        errorDiv.textContent = 'This username is reserved';
        errorDiv.style.display = 'block';
        return;
    }
    
    if (!password) {
        errorDiv.textContent = 'Please enter a password';
        errorDiv.style.display = 'block';
        return;
    }
    
    if (password.length < 6) {
        errorDiv.textContent = 'Password must be at least 6 characters';
        errorDiv.style.display = 'block';
        return;
    }
    
    if (password !== confirmPassword) {
        errorDiv.textContent = 'Passwords do not match';
        errorDiv.style.display = 'block';
        return;
    }
    
    try {
        errorDiv.style.display = 'none';
        
        const email = username + '@aurababymarket.app';
        
        // Check if username exists
        const usernameDoc = await db.collection('usernames').doc(username).get();
        if (usernameDoc.exists) {
            errorDiv.textContent = 'Username already taken. Please choose another.';
            errorDiv.style.display = 'block';
            return;
        }
        
        // Create account
        const result = await auth.createUserWithEmailAndPassword(email, password);
        
        // Store username mapping
        await db.collection('usernames').doc(username).set({
            uid: result.user.uid,
            createdAt: firebase.firestore.FieldValue.serverTimestamp()
        });
        
        // Create initial user document with username
        await db.collection('users').doc(result.user.uid).set({
            username: username,
            money: 1000,
            portfolio: {},
            limitedInventory: {},
            limitedMintCounts: {},
            tradeHistory: [],
            highestMoney: 1000,
            highestNetWorth: 1000,
            priceHistory: [],
            createdAt: firebase.firestore.FieldValue.serverTimestamp()
        });
        
        console.log('‚úÖ Account created with username:', username);
        
    } catch (error) {
        if (error.code === 'auth/email-already-in-use') {
            errorDiv.textContent = 'Username already taken. Please choose another.';
        } else if (error.code === 'auth/weak-password') {
            errorDiv.textContent = 'Password is too weak. Use at least 6 characters.';
        } else {
            errorDiv.textContent = 'Signup failed: ' + error.message;
        }
        errorDiv.style.display = 'block';
    }
}

// ===================================
// ANONYMOUS LOGIN
// ===================================

async function loginAnonymous() {
    const errorDiv = document.getElementById('login-error');
    try {
        errorDiv.style.display = 'none';
        await auth.signInAnonymously();
    } catch (error) {
        errorDiv.textContent = 'Guest login failed. Please try again.';
        errorDiv.style.display = 'block';
    }
}

// ===================================
// LOGOUT
// ===================================

async function logoutUser() {
    if (confirm('Are you sure you want to logout? Your progress is saved automatically.')) {
        await saveGameData();
        await auth.signOut();
    }
}

// ===================================
// AUTH STATE OBSERVER
// ===================================

auth.onAuthStateChanged(async (user) => {
    if (user) {
        currentUserAuth = user;
        userDocRef = db.collection('users').doc(user.uid);
        
        // Show loading
        document.getElementById('login-form').style.display = 'none';
        document.getElementById('signup-form').style.display = 'none';
        document.getElementById('loading-screen').style.display = 'block';
        
        // Load game data
        await loadGameData();
        
        // Hide auth, show game
        document.getElementById('auth-container').style.display = 'none';
        document.getElementById('game-container').style.display = 'block';
        
        // Initialize game (React will mount)
        if (!gameStateLoaded) {
            gameStateLoaded = true;
        }
    } else {
        currentUserAuth = null;
        userDocRef = null;
        gameStateLoaded = false;
        document.getElementById('auth-container').style.display = 'flex';
        document.getElementById('game-container').style.display = 'none';
        showLogin();
    }
});

// ===================================
// SAVE/LOAD FUNCTIONS
// ===================================

async function loadGameData() {
    if (!userDocRef) return;
    
    try {
        const doc = await userDocRef.get();
        
        // Get username from email or usernames collection
        let username = 'Trader';
        if (currentUserAuth.isAnonymous) {
            username = 'Guest_' + Date.now();
        } else if (currentUserAuth.email) {
            // Extract username from email (username@aurababymarket.app)
            username = currentUserAuth.email.split('@')[0];
        }
        
        if (doc.exists) {
            const data = doc.data();
            window.gameState = {
                username: data.username || username,
                money: data.money !== undefined ? data.money : 1000,
                portfolio: data.portfolio || {},
                limitedInventory: data.limitedInventory || {},
                limitedMintCounts: data.limitedMintCounts || {},
                tradeHistory: data.tradeHistory || [],
                highestMoney: data.highestMoney || 1000,
                highestNetWorth: data.highestNetWorth || 1000,
                priceHistory: data.priceHistory || [],
                createdAt: data.createdAt || null
            };
            console.log('‚úÖ Game data loaded!', window.gameState);
        } else {
            // New user - create initial document with proper username
            window.gameState = {
                username: username,
                money: 1000,
                portfolio: {},
                limitedInventory: {},
                limitedMintCounts: {},
                tradeHistory: [],
                highestMoney: 1000,
                highestNetWorth: 1000,
                priceHistory: [],
                createdAt: new Date()
            };
            console.log('üìù Creating new user with username:', username);
            await saveGameData();
        }
    } catch (error) {
        console.error('‚ùå Load failed:', error);
    }
}

async function saveGameData() {
    if (!userDocRef || !window.gameState) return;
    
    try {
        console.log('üíæ Saving game data...', {
            username: window.gameState.username,
            money: window.gameState.money,
            babiesOwned: Object.values(window.gameState.portfolio).reduce((sum, qty) => sum + qty, 0),
            limitedsOwned: Object.values(window.gameState.limitedInventory).reduce((sum, arr) => sum + arr.length, 0),
            trades: window.gameState.tradeHistory.length
        });
        
        await userDocRef.set({
            username: window.gameState.username,
            money: window.gameState.money,
            portfolio: window.gameState.portfolio,
            limitedInventory: window.gameState.limitedInventory,
            limitedMintCounts: window.gameState.limitedMintCounts,
            tradeHistory: window.gameState.tradeHistory,
            highestMoney: window.gameState.highestMoney,
            highestNetWorth: window.gameState.highestNetWorth,
            priceHistory: window.gameState.priceHistory,
            createdAt: window.gameState.createdAt || firebase.firestore.FieldValue.serverTimestamp(),
            lastSaved: firebase.firestore.FieldValue.serverTimestamp()
        }, { merge: true });
        
        console.log('‚úÖ Game saved successfully!');
    } catch (error) {
        console.error('‚ùå Save failed:', error);
    }
}

// Auto-save every 30 seconds
setInterval(() => {
    if (currentUserAuth && window.gameState) {
        saveGameData();
    }
}, 30000);

// Save before closing
window.addEventListener('beforeunload', () => {
    if (currentUserAuth && window.gameState) {
        saveGameData();
    }
});
    </script>

    <script>
// MULTIPLAYER FEATURES WITH GLOBAL PRICE SYNC
let multiplayerCurrentUser = null;

// Update on auth change
auth.onAuthStateChanged((user) => {
    if (user) {
        multiplayerCurrentUser = user;
    }
});

// ===================================
// GLOBAL PRICE SYSTEM (SYNCED VIA FIREBASE)
// ===================================

async function initializeGlobalPrices(babyIds, limitedItems) {
    if (!db) return;
    
    try {
        const priceDoc = await db.collection('globalPrices').doc('current').get();
        
        if (!priceDoc.exists) {
            console.log('üîß Initializing global prices for the first time...');
            
            const babyPrices = {};
            babyIds.forEach(id => { babyPrices[id] = 150; });
            
            const limitedValues = {};
            limitedItems.forEach(item => {
                limitedValues[item.id] = (item.minValue + item.maxValue) / 2;
            });
            
            await db.collection('globalPrices').doc('current').set({
                babyPrices: babyPrices,
                limitedValues: limitedValues,
                priceHistory: [{
                    timestamp: Date.now(),
                    babyPrices: { ...babyPrices },
                    limitedValues: { ...limitedValues }
                }],
                lastUpdate: firebase.firestore.FieldValue.serverTimestamp(),
                nextUpdateTime: firebase.firestore.Timestamp.fromDate(
                    new Date(Date.now() + 2 * 60 * 1000)
                ),
                updateCount: 0
            });
            
            console.log('‚úÖ Global prices initialized!');
        }
    } catch (error) {
        console.error('Initialize prices failed:', error);
    }
}

async function forceUpdateGlobalPrices(babies, limitedItems) {
    if (!db) return false;
    
    try {
        console.log('üöÄ FORCE UPDATING PRICES NOW!');
        
        const priceDoc = await db.collection('globalPrices').doc('current').get();
        
        if (!priceDoc.exists) {
            await initializeGlobalPrices(babies.map(b => b.id), limitedItems);
            return true;
        }
        
        const currentData = priceDoc.data();
        const newBabyPrices = { ...currentData.babyPrices };
        const newLimitedValues = { ...currentData.limitedValues };
        
        // Update baby prices
        babies.forEach(baby => {
            const changePercent = (Math.random() * 0.3 - 0.15);
            const oldPrice = newBabyPrices[baby.id] || 150;
            let newPrice = oldPrice + (oldPrice * changePercent);
            
            if (newPrice < 10) newPrice = 10;
            if (newPrice > 1000) newPrice = 1000;
            
            newBabyPrices[baby.id] = Math.round(newPrice * 100) / 100;
        });
        
        // Update limited values
        limitedItems.forEach(item => {
            const changePercent = (Math.random() * 0.2 - 0.1);
            const oldValue = newLimitedValues[item.id] || (item.minValue + item.maxValue) / 2;
            let newValue = oldValue + (oldValue * changePercent);
            
            if (newValue < item.minValue) newValue = item.minValue;
            if (newValue > item.maxValue) newValue = item.maxValue;
            
            newLimitedValues[item.id] = Math.round(newValue * 100) / 100;
        });
        
        // Update price history (keep last 50 data points)
        const priceHistory = currentData.priceHistory || [];
        priceHistory.push({
            timestamp: Date.now(),
            babyPrices: { ...newBabyPrices },
            limitedValues: { ...newLimitedValues }
        });
        
        if (priceHistory.length > 50) {
            priceHistory.shift();
        }
        
        await db.collection('globalPrices').doc('current').update({
            babyPrices: newBabyPrices,
            limitedValues: newLimitedValues,
            priceHistory: priceHistory,
            lastUpdate: firebase.firestore.FieldValue.serverTimestamp(),
            nextUpdateTime: firebase.firestore.Timestamp.fromDate(
                new Date(Date.now() + 2 * 60 * 1000)
            ),
            updateCount: (currentData.updateCount || 0) + 1
        });
        
        console.log('‚úÖ PRICES UPDATED! Update #', (currentData.updateCount || 0) + 1);
        return true;
    } catch (error) {
        console.error('Force update prices failed:', error);
        return false;
    }
}

function listenToGlobalPrices(callback) {
    if (!db) return () => {};
    
    console.log('üëÇ Listening for real-time price updates...');
    
    const unsubscribe = db.collection('globalPrices').doc('current')
        .onSnapshot((doc) => {
            if (doc.exists) {
                const data = doc.data();
                console.log('üìä PRICE UPDATE RECEIVED! Update #', data.updateCount || 0);
                callback({
                    babyPrices: data.babyPrices || {},
                    limitedValues: data.limitedValues || {},
                    priceHistory: data.priceHistory || [],
                    lastUpdate: data.lastUpdate,
                    nextUpdateTime: data.nextUpdateTime,
                    updateCount: data.updateCount || 0
                });
            }
        }, (error) => {
            console.error('Price listener error:', error);
        });
    
    return unsubscribe;
}

// ===================================
// LEADERBOARD SYSTEM
// ===================================

async function updateLeaderboard(playerData) {
    if (!multiplayerCurrentUser || !db) return;
    
    try {
        const netWorth = playerData.money + playerData.portfolioValue + playerData.limitedValue;
        const totalBabies = Object.values(playerData.portfolio).reduce((sum, qty) => sum + qty, 0);
        const totalLimiteds = Object.values(playerData.limitedInventory).reduce((sum, arr) => sum + arr.length, 0);
        
        await db.collection('leaderboard').doc(multiplayerCurrentUser.uid).set({
            username: playerData.username,
            netWorth: netWorth,
            money: playerData.money,
            portfolioValue: playerData.portfolioValue,
            limitedValue: playerData.limitedValue,
            totalTrades: playerData.tradeHistory.length,
            babiesOwned: totalBabies,
            limitedsOwned: totalLimiteds,
            lastUpdated: firebase.firestore.FieldValue.serverTimestamp()
        });
        
        console.log('Leaderboard updated!');
    } catch (error) {
        console.error('Leaderboard update failed:', error);
    }
}

async function loadLeaderboard() {
    if (!db) return [];
    
    try {
        const snapshot = await db.collection('leaderboard')
            .orderBy('netWorth', 'desc')
            .limit(10)
            .get();
        
        const leaders = [];
        snapshot.forEach(doc => {
            leaders.push({ 
                id: doc.id, 
                ...doc.data(),
                isCurrentUser: multiplayerCurrentUser && doc.id === multiplayerCurrentUser.uid
            });
        });
        
        return leaders;
    } catch (error) {
        console.error('Load leaderboard failed:', error);
        return [];
    }
}

// ===================================
// PLAYER TRADING SYSTEM
// ===================================

async function createTradeOffer(offerData) {
    if (!multiplayerCurrentUser || !db) return null;
    
    try {
        const offer = {
            fromUserId: multiplayerCurrentUser.uid,
            fromUsername: offerData.fromUsername,
            toUserId: offerData.toUserId,
            toUsername: offerData.toUsername,
            offering: offerData.offering, // {babies: {}, limiteds: [], cash: 0}
            requesting: offerData.requesting,
            status: 'pending',
            createdAt: firebase.firestore.FieldValue.serverTimestamp(),
            expiresAt: firebase.firestore.Timestamp.fromDate(
                new Date(Date.now() + 24 * 60 * 60 * 1000) // 24 hours
            )
        };
        
        const docRef = await db.collection('tradeOffers').add(offer);
        console.log('Trade offer created!', docRef.id);
        return docRef.id;
    } catch (error) {
        console.error('Create trade offer failed:', error);
        return null;
    }
}

async function loadMyTradeOffers() {
    if (!multiplayerCurrentUser || !db) return [];
    
    try {
        const snapshot = await db.collection('tradeOffers')
            .where('toUserId', '==', multiplayerCurrentUser.uid)
            .where('status', '==', 'pending')
            .orderBy('createdAt', 'desc')
            .get();
        
        const offers = [];
        snapshot.forEach(doc => {
            offers.push({ id: doc.id, ...doc.data() });
        });
        
        return offers;
    } catch (error) {
        console.error('Load trade offers failed:', error);
        return [];
    }
}

async function acceptTradeOffer(offerId) {
    if (!multiplayerCurrentUser || !db) return false;
    
    try {
        await db.collection('tradeOffers').doc(offerId).update({
            status: 'accepted',
            acceptedAt: firebase.firestore.FieldValue.serverTimestamp()
        });
        
        return true;
    } catch (error) {
        console.error('Accept trade failed:', error);
        return false;
    }
}

async function rejectTradeOffer(offerId) {
    if (!multiplayerCurrentUser || !db) return false;
    
    try {
        await db.collection('tradeOffers').doc(offerId).update({
            status: 'rejected',
            rejectedAt: firebase.firestore.FieldValue.serverTimestamp()
        });
        
        return true;
    } catch (error) {
        console.error('Reject trade failed:', error);
        return false;
    }
}

// ===================================
// TRADE ADS SYSTEM
// ===================================

async function postTradeAd(adData) {
    if (!multiplayerCurrentUser || !db) return null;
    
    try {
        const ad = {
            userId: multiplayerCurrentUser.uid,
            username: adData.username,
            type: adData.type,
            description: adData.description || '',
            offering: adData.offering || '',
            lookingFor: adData.lookingFor || '',
            status: 'active',
            createdAt: firebase.firestore.FieldValue.serverTimestamp(),
            expiresAt: firebase.firestore.Timestamp.fromDate(
                new Date(Date.now() + 7 * 24 * 60 * 60 * 1000)
            )
        };
        
        const docRef = await db.collection('tradeAds').add(ad);
        console.log('Trade ad posted!', docRef.id);
        return docRef.id;
    } catch (error) {
        console.error('Post trade ad failed:', error);
        return null;
    }
}

async function loadTradeAds(filterType = null) {
    if (!db) return [];
    
    try {
        let query = db.collection('tradeAds')
            .where('status', '==', 'active')
            .orderBy('createdAt', 'desc')
            .limit(50);
        
        if (filterType) {
            query = query.where('type', '==', filterType);
        }
        
        const snapshot = await query.get();
        
        const ads = [];
        snapshot.forEach(doc => {
            ads.push({ 
                id: doc.id, 
                ...doc.data(),
                isMyAd: multiplayerCurrentUser && doc.data().userId === multiplayerCurrentUser.uid
            });
        });
        
        return ads;
    } catch (error) {
        console.error('Load trade ads failed:', error);
        return [];
    }
}

async function deleteTradeAd(adId) {
    if (!multiplayerCurrentUser || !db) return false;
    
    try {
        const adDoc = await db.collection('tradeAds').doc(adId).get();
        
        if (!adDoc.exists) return false;
        
        if (adDoc.data().userId !== multiplayerCurrentUser.uid) return false;
        
        await db.collection('tradeAds').doc(adId).update({
            status: 'cancelled',
            cancelledAt: firebase.firestore.FieldValue.serverTimestamp()
        });
        
        return true;
    } catch (error) {
        console.error('Delete trade ad failed:', error);
        return false;
    }
}

// Make functions globally available
window.multiplayer = {
    initializeGlobalPrices,
    forceUpdateGlobalPrices,
    listenToGlobalPrices,
    updateLeaderboard,
    loadLeaderboard,
    createTradeOffer,
    loadMyTradeOffers,
    acceptTradeOffer,
    rejectTradeOffer,
    postTradeAd,
    loadTradeAds,
    deleteTradeAd
};

console.log('üéÆ Multiplayer module loaded!');
    </script>

    <script type="text/babel">
const { useState, useEffect, useRef } = React;

// Market hours: 9 AM to 9 PM
function isMarketOpen() {
    const now = new Date();
    const hour = now.getHours();
    return hour >= 9 && hour < 21;
}

function formatTime(seconds) {
    const mins = Math.floor(seconds / 60);
    const secs = seconds % 60;
    return `${mins}m ${secs}s`;
}

function getTimeUntilMarketChange() {
    const now = new Date();
    const hour = now.getHours();
    
    if (hour < 9) {
        const open = new Date(now);
        open.setHours(9, 0, 0, 0);
        return Math.floor((open - now) / 1000);
    } else if (hour >= 21) {
        const open = new Date(now);
        open.setDate(open.getDate() + 1);
        open.setHours(9, 0, 0, 0);
        return Math.floor((open - now) / 1000);
    } else {
        const close = new Date(now);
        close.setHours(21, 0, 0, 0);
        return Math.floor((close - now) / 1000);
    }
}

function getTimeUntilNextPriceUpdate(nextUpdateTimestamp) {
    if (!nextUpdateTimestamp) return 120;
    
    const now = Date.now();
    const nextUpdate = nextUpdateTimestamp.toMillis ? nextUpdateTimestamp.toMillis() : nextUpdateTimestamp;
    const diff = Math.floor((nextUpdate - now) / 1000);
    
    return diff > 0 ? diff : 0;
}

const AurababyMarket = () => {
    const babies = [
        { id: 1, name: 'Aurababy', image: 'https://i.ibb.co/Y4L448c1/aurababy.jpg' },
        { id: 2, name: 'KingDarren', image: 'https://i.ibb.co/1YGkQ5M4/kingdarren.jpg' },
        { id: 3, name: 'Daniel', image: 'https://i.ibb.co/RTwqxcck/daniel.jpg' },
        { id: 4, name: 'Manuel', image: 'https://i.ibb.co/JRr6BWjb/theonewhocknocks.jpg' },
        { id: 5, name: 'Grant', image: 'https://i.ibb.co/TqHnrtSp/grant.jpg' },
        { id: 6, name: 'Joony', image: 'https://i.ibb.co/fd9Kg05w/output.jpg' },
        { id: 7, name: 'Zoely', image: 'https://i.ibb.co/fVLDq186/zoely.png' },
        { id: 8, name: 'Lemmet', image: 'https://i.ibb.co/TBmZmYYh/newlemmet.jpg' },
        { id: 9, name: 'Kelly', image: 'https://i.ibb.co/Xk2DybZg/kelly.jpg' },
        { id: 10, name: 'Bryce', image: 'https://i.ibb.co/pvgyknnq/bryce.jpg' },
        { id: 11, name: 'FattieBaby', image: 'https://i.ibb.co/FkyMMCRv/fattiebaby.jpg' },
        { id: 12, name: 'Goonerbaby', image: 'https://i.ibb.co/b5DH8g26/goonerbaby.jpg' },
        { id: 13, name: 'Teros', image: 'https://i.ibb.co/Nd6v0WjN/teros.jpg' },
        { id: 14, name: 'Darkbaby', image: 'https://i.ibb.co/vCTDWs40/output-1.jpg' },
        { id: 15, name: 'GangstaBaby', image: 'https://i.ibb.co/TM91vD3z/Officalgangstababy.png' },
        { id: 16, name: 'Poorbaby', image: 'https://i.ibb.co/Nn9v6ZBw/poorbaby.jpg' },
        { id: 17, name: 'RichBaby', image: 'https://i.ibb.co/DDSNbypf/richbaby.jpg' },
        { id: 18, name: 'The Baby That Holds Aura', image: 'https://i.ibb.co/Kx8ZSGCB/The-Baby-That-Holds-Aura.jpg' },
        { id: 19, name: 'JollyBaby', image: 'https://i.ibb.co/bgp5mdQZ/jollybaby.png' },
        { id: 20, name: 'CupidBaby', image: 'https://i.ibb.co/1GbNb2PX/Untitled-4.png' },
        { id: 21, name: 'Judgment Baby', image: 'https://i.ibb.co/TqtxsJ52/judgment.jpg' },
        { id: 22, name: 'Justicen', image: 'https://i.ibb.co/dwkHnD65/Justicebaby.jpg' }
    ];

    const limitedItems = [
        // FIRST 100 ITEMS (from before)
        { id: 'cat', name: 'Lucky Cat', emoji: 'üê±', cost: 500, minValue: 300, maxValue: 900, rarity: 'Common' },
        { id: 'dog', name: 'Diamond Dog', emoji: 'üê∂', cost: 600, minValue: 400, maxValue: 1000, rarity: 'Common' },
        { id: 'panda', name: 'Rare Panda', emoji: 'üêº', cost: 800, minValue: 500, maxValue: 1300, rarity: 'Common' },
        { id: 'tiger', name: 'Tiger Spirit', emoji: 'üêØ', cost: 900, minValue: 600, maxValue: 1500, rarity: 'Common' },
        { id: 'lion', name: 'Lion King', emoji: 'ü¶Å', cost: 1000, minValue: 700, maxValue: 1700, rarity: 'Rare' },
        { id: 'monkey', name: 'Wise Monkey', emoji: 'üêµ', cost: 550, minValue: 350, maxValue: 950, rarity: 'Common' },
        { id: 'pig', name: 'Golden Pig', emoji: 'üê∑', cost: 700, minValue: 450, maxValue: 1200, rarity: 'Common' },
        { id: 'frog', name: 'Prince Frog', emoji: 'üê∏', cost: 650, minValue: 400, maxValue: 1100, rarity: 'Common' },
        { id: 'hamster', name: 'Cute Hamster', emoji: 'üêπ', cost: 500, minValue: 300, maxValue: 900, rarity: 'Common' },
        { id: 'rabbit', name: 'Moon Rabbit', emoji: 'üê∞', cost: 750, minValue: 500, maxValue: 1250, rarity: 'Common' },
        { id: 'crown', name: 'Crown Aura', emoji: 'üëë', cost: 1000, minValue: 700, maxValue: 1700, rarity: 'Rare' },
        { id: 'fire', name: 'Fire Essence', emoji: 'üî•', cost: 1500, minValue: 1000, maxValue: 2500, rarity: 'Rare' },
        { id: 'lightning', name: 'Lightning Power', emoji: '‚ö°', cost: 1800, minValue: 1200, maxValue: 3000, rarity: 'Epic' },
        { id: 'star', name: 'Star Collector', emoji: 'üåü', cost: 2000, minValue: 1500, maxValue: 3500, rarity: 'Epic' },
        { id: 'paint', name: 'Rare Paint', emoji: 'üé®', cost: 1200, minValue: 800, maxValue: 2000, rarity: 'Rare' },
        { id: 'mask', name: 'Mystery Mask', emoji: 'üé≠', cost: 1600, minValue: 1100, maxValue: 2800, rarity: 'Rare' },
        { id: 'music', name: 'Music Note', emoji: 'üéµ', cost: 1300, minValue: 900, maxValue: 2200, rarity: 'Rare' },
        { id: 'magic', name: 'Magic Wand', emoji: 'ü™Ñ', cost: 1700, minValue: 1200, maxValue: 2900, rarity: 'Rare' },
        { id: 'crystal', name: 'Crystal Ball', emoji: 'üîÆ', cost: 1900, minValue: 1400, maxValue: 3200, rarity: 'Epic' },
        { id: 'rocket', name: 'Space Rocket', emoji: 'üöÄ', cost: 1500, minValue: 1000, maxValue: 2500, rarity: 'Rare' },
        { id: 'diamond', name: 'Diamond Baby', emoji: 'üíé', cost: 2500, minValue: 2000, maxValue: 4000, rarity: 'Legendary' },
        { id: 'trophy', name: 'Trophy Gold', emoji: 'üèÜ', cost: 3000, minValue: 2500, maxValue: 5000, rarity: 'Legendary' },
        { id: 'unicorn', name: 'Unicorn Spirit', emoji: 'ü¶Ñ', cost: 2200, minValue: 1700, maxValue: 3800, rarity: 'Epic' },
        { id: 'rainbow', name: 'Rainbow Aura', emoji: 'üåà', cost: 2800, minValue: 2200, maxValue: 4500, rarity: 'Legendary' },
        { id: 'dragon', name: 'Dragon Power', emoji: 'üêâ', cost: 3500, minValue: 3000, maxValue: 5500, rarity: 'Divine' },
        { id: 'gem', name: 'Ruby Gem', emoji: 'üíç', cost: 2700, minValue: 2100, maxValue: 4300, rarity: 'Legendary' },
        { id: 'castle', name: 'Royal Castle', emoji: 'üè∞', cost: 3200, minValue: 2700, maxValue: 5200, rarity: 'Legendary' },
        { id: 'alien', name: 'Alien Tech', emoji: 'üëΩ', cost: 2900, minValue: 2400, maxValue: 4700, rarity: 'Epic' },
        { id: 'robot', name: 'Robot Future', emoji: 'ü§ñ', cost: 2600, minValue: 2000, maxValue: 4200, rarity: 'Epic' },
        { id: 'phoenix', name: 'Phoenix Rising', emoji: 'ü¶Ö', cost: 3300, minValue: 2800, maxValue: 5300, rarity: 'Divine' },
        { id: 'pizza', name: 'Pizza Paradise', emoji: 'üçï', cost: 800, minValue: 500, maxValue: 1300, rarity: 'Common' },
        { id: 'burger', name: 'Burger King', emoji: 'üçî', cost: 750, minValue: 450, maxValue: 1250, rarity: 'Common' },
        { id: 'sushi', name: 'Sushi Master', emoji: 'üç£', cost: 1100, minValue: 700, maxValue: 1800, rarity: 'Rare' },
        { id: 'cake', name: 'Birthday Cake', emoji: 'üéÇ', cost: 900, minValue: 600, maxValue: 1500, rarity: 'Common' },
        { id: 'donut', name: 'Sweet Donut', emoji: 'üç©', cost: 650, minValue: 400, maxValue: 1100, rarity: 'Common' },
        { id: 'icecream', name: 'Ice Cream', emoji: 'üç¶', cost: 700, minValue: 450, maxValue: 1200, rarity: 'Common' },
        { id: 'cookie', name: 'Magic Cookie', emoji: 'üç™', cost: 600, minValue: 350, maxValue: 1000, rarity: 'Common' },
        { id: 'candy', name: 'Rare Candy', emoji: 'üç¨', cost: 550, minValue: 300, maxValue: 950, rarity: 'Common' },
        { id: 'watermelon', name: 'Summer Melon', emoji: 'üçâ', cost: 850, minValue: 550, maxValue: 1400, rarity: 'Common' },
        { id: 'strawberry', name: 'Berry Sweet', emoji: 'üçì', cost: 700, minValue: 400, maxValue: 1200, rarity: 'Common' },
        { id: 'key', name: 'Golden Key', emoji: 'üîë', cost: 1400, minValue: 1000, maxValue: 2300, rarity: 'Rare' },
        { id: 'lock', name: 'Ancient Lock', emoji: 'üîí', cost: 1300, minValue: 900, maxValue: 2200, rarity: 'Rare' },
        { id: 'bomb', name: 'Boom Bomb', emoji: 'üí£', cost: 1100, minValue: 700, maxValue: 1900, rarity: 'Rare' },
        { id: 'gift', name: 'Mystery Gift', emoji: 'üéÅ', cost: 1500, minValue: 1000, maxValue: 2500, rarity: 'Rare' },
        { id: 'balloon', name: 'Party Balloon', emoji: 'üéà', cost: 600, minValue: 350, maxValue: 1000, rarity: 'Common' },
        { id: 'dice', name: 'Lucky Dice', emoji: 'üé≤', cost: 900, minValue: 600, maxValue: 1500, rarity: 'Common' },
        { id: 'magnify', name: 'Magnifier', emoji: 'üîç', cost: 800, minValue: 500, maxValue: 1300, rarity: 'Common' },
        { id: 'scissors', name: 'Gold Scissors', emoji: '‚úÇÔ∏è', cost: 750, minValue: 450, maxValue: 1250, rarity: 'Common' },
        { id: 'hammer', name: 'Thor Hammer', emoji: 'üî®', cost: 1200, minValue: 800, maxValue: 2000, rarity: 'Rare' },
        { id: 'wrench', name: 'Master Wrench', emoji: 'üîß', cost: 950, minValue: 600, maxValue: 1600, rarity: 'Common' },
        { id: 'soccer', name: 'Soccer Star', emoji: '‚öΩ', cost: 1100, minValue: 700, maxValue: 1800, rarity: 'Rare' },
        { id: 'basketball', name: 'Hoop Dreams', emoji: 'üèÄ', cost: 1200, minValue: 800, maxValue: 2000, rarity: 'Rare' },
        { id: 'football', name: 'Football Pro', emoji: 'üèà', cost: 1150, minValue: 750, maxValue: 1900, rarity: 'Rare' },
        { id: 'tennis', name: 'Tennis Ace', emoji: 'üéæ', cost: 1000, minValue: 650, maxValue: 1700, rarity: 'Rare' },
        { id: 'baseball', name: 'Home Run', emoji: '‚öæ', cost: 1050, minValue: 700, maxValue: 1750, rarity: 'Rare' },
        { id: 'bowling', name: 'Strike King', emoji: 'üé≥', cost: 900, minValue: 600, maxValue: 1500, rarity: 'Common' },
        { id: 'golf', name: 'Golf Master', emoji: '‚õ≥', cost: 1300, minValue: 900, maxValue: 2200, rarity: 'Rare' },
        { id: 'ski', name: 'Ski Champion', emoji: '‚õ∑Ô∏è', cost: 1400, minValue: 1000, maxValue: 2300, rarity: 'Rare' },
        { id: 'surf', name: 'Wave Rider', emoji: 'üèÑ', cost: 1250, minValue: 850, maxValue: 2100, rarity: 'Rare' },
        { id: 'bike', name: 'Speed Bike', emoji: 'üö¥', cost: 1100, minValue: 700, maxValue: 1850, rarity: 'Rare' },
        { id: 'sun', name: 'Sunny Day', emoji: '‚òÄÔ∏è', cost: 1600, minValue: 1100, maxValue: 2700, rarity: 'Epic' },
        { id: 'moon', name: 'Moon Light', emoji: 'üåô', cost: 1700, minValue: 1200, maxValue: 2900, rarity: 'Epic' },
        { id: 'cloud', name: 'Cloud Nine', emoji: '‚òÅÔ∏è', cost: 800, minValue: 500, maxValue: 1300, rarity: 'Common' },
        { id: 'snow', name: 'Snowflake', emoji: '‚ùÑÔ∏è', cost: 1000, minValue: 650, maxValue: 1700, rarity: 'Rare' },
        { id: 'thunder', name: 'Thunder Storm', emoji: '‚õàÔ∏è', cost: 1500, minValue: 1000, maxValue: 2500, rarity: 'Rare' },
        { id: 'tornado', name: 'Tornado Spin', emoji: 'üå™Ô∏è', cost: 1800, minValue: 1300, maxValue: 3000, rarity: 'Epic' },
        { id: 'ocean', name: 'Ocean Wave', emoji: 'üåä', cost: 1400, minValue: 950, maxValue: 2400, rarity: 'Rare' },
        { id: 'volcano', name: 'Volcano Blast', emoji: 'üåã', cost: 2000, minValue: 1500, maxValue: 3300, rarity: 'Epic' },
        { id: 'earth', name: 'Planet Earth', emoji: 'üåç', cost: 2500, minValue: 2000, maxValue: 4000, rarity: 'Legendary' },
        { id: 'comet', name: 'Comet Tail', emoji: '‚òÑÔ∏è', cost: 2200, minValue: 1700, maxValue: 3700, rarity: 'Epic' },
        { id: 'heart', name: 'Love Heart', emoji: '‚ù§Ô∏è', cost: 1200, minValue: 800, maxValue: 2000, rarity: 'Rare' },
        { id: 'sparkle', name: 'Sparkle Shine', emoji: '‚ú®', cost: 1100, minValue: 700, maxValue: 1850, rarity: 'Rare' },
        { id: 'check', name: 'Check Mark', emoji: '‚úÖ', cost: 900, minValue: 600, maxValue: 1500, rarity: 'Common' },
        { id: 'cross', name: 'Red Cross', emoji: '‚ùå', cost: 850, minValue: 550, maxValue: 1400, rarity: 'Common' },
        { id: 'warn', name: 'Warning Sign', emoji: '‚ö†Ô∏è', cost: 950, minValue: 600, maxValue: 1600, rarity: 'Common' },
        { id: 'recycle', name: 'Eco Recycle', emoji: '‚ôªÔ∏è', cost: 1000, minValue: 650, maxValue: 1700, rarity: 'Rare' },
        { id: 'peace', name: 'Peace Sign', emoji: '‚òÆÔ∏è', cost: 1300, minValue: 900, maxValue: 2200, rarity: 'Rare' },
        { id: 'infinity', name: 'Infinity Loop', emoji: '‚ôæÔ∏è', cost: 2100, minValue: 1600, maxValue: 3600, rarity: 'Epic' },
        { id: 'atom', name: 'Atom Power', emoji: '‚öõÔ∏è', cost: 1900, minValue: 1400, maxValue: 3200, rarity: 'Epic' },
        { id: 'yin', name: 'Yin Yang', emoji: '‚òØÔ∏è', cost: 1800, minValue: 1300, maxValue: 3000, rarity: 'Epic' },
        { id: 'rose', name: 'Red Rose', emoji: 'üåπ', cost: 1100, minValue: 700, maxValue: 1850, rarity: 'Rare' },
        { id: 'tulip', name: 'Tulip Bloom', emoji: 'üå∑', cost: 1000, minValue: 650, maxValue: 1700, rarity: 'Rare' },
        { id: 'sunflower', name: 'Sunflower', emoji: 'üåª', cost: 950, minValue: 600, maxValue: 1600, rarity: 'Rare' },
        { id: 'cherry', name: 'Cherry Blossom', emoji: 'üå∏', cost: 1200, minValue: 800, maxValue: 2000, rarity: 'Rare' },
        { id: 'bouquet', name: 'Flower Bouquet', emoji: 'üíê', cost: 1300, minValue: 900, maxValue: 2200, rarity: 'Rare' },
        { id: 'cactus', name: 'Desert Cactus', emoji: 'üåµ', cost: 800, minValue: 500, maxValue: 1300, rarity: 'Common' },
        { id: 'tree', name: 'Life Tree', emoji: 'üå≥', cost: 1400, minValue: 1000, maxValue: 2300, rarity: 'Rare' },
        { id: 'palm', name: 'Palm Tree', emoji: 'üå¥', cost: 1100, minValue: 700, maxValue: 1850, rarity: 'Rare' },
        { id: 'leaf', name: 'Lucky Leaf', emoji: 'üçÄ', cost: 900, minValue: 600, maxValue: 1500, rarity: 'Common' },
        { id: 'maple', name: 'Maple Leaf', emoji: 'üçÅ', cost: 950, minValue: 625, maxValue: 1600, rarity: 'Common' },
        { id: 'computer', name: 'Super Computer', emoji: 'üíª', cost: 1500, minValue: 1000, maxValue: 2500, rarity: 'Rare' },
        { id: 'phone', name: 'Smart Phone', emoji: 'üì±', cost: 1200, minValue: 800, maxValue: 2000, rarity: 'Rare' },
        { id: 'camera', name: 'Pro Camera', emoji: 'üì∑', cost: 1300, minValue: 900, maxValue: 2200, rarity: 'Rare' },
        { id: 'battery', name: 'Power Battery', emoji: 'üîã', cost: 1000, minValue: 650, maxValue: 1700, rarity: 'Rare' },
        { id: 'satellite', name: 'Satellite', emoji: 'üõ∞Ô∏è', cost: 2000, minValue: 1500, maxValue: 3300, rarity: 'Epic' },
        { id: 'ufo', name: 'UFO Ship', emoji: 'üõ∏', cost: 2400, minValue: 1900, maxValue: 3900, rarity: 'Legendary' },
        { id: 'game', name: 'Game Console', emoji: 'üéÆ', cost: 1400, minValue: 1000, maxValue: 2300, rarity: 'Rare' },
        { id: 'joystick', name: 'Joystick Pro', emoji: 'üïπÔ∏è', cost: 1100, minValue: 700, maxValue: 1850, rarity: 'Rare' },
        { id: 'dvd', name: 'Retro DVD', emoji: 'üíø', cost: 800, minValue: 500, maxValue: 1300, rarity: 'Common' },
        { id: 'vr', name: 'VR Goggles', emoji: 'ü•Ω', cost: 1800, minValue: 1300, maxValue: 3000, rarity: 'Epic' },
        
        // NEW 100 ITEMS (8 DIVINE!)
        { id: 'godmode', name: 'God Mode', emoji: 'üî±', cost: 5000, minValue: 4500, maxValue: 8000, rarity: 'Divine' },
        { id: 'celestial', name: 'Celestial Crown', emoji: 'üëº', cost: 4800, minValue: 4200, maxValue: 7500, rarity: 'Divine' },
        { id: 'eternal', name: 'Eternal Flame', emoji: 'üïØÔ∏è', cost: 4600, minValue: 4000, maxValue: 7200, rarity: 'Divine' },
        { id: 'cosmic', name: 'Cosmic Energy', emoji: 'üåå', cost: 5200, minValue: 4700, maxValue: 8200, rarity: 'Divine' },
        { id: 'supreme', name: 'Supreme Power', emoji: '‚öúÔ∏è', cost: 4900, minValue: 4400, maxValue: 7800, rarity: 'Divine' },
        { id: 'divine_sword', name: 'Divine Sword', emoji: '‚öîÔ∏è', cost: 5100, minValue: 4600, maxValue: 8100, rarity: 'Divine' },
        { id: 'holy_grail', name: 'Holy Grail', emoji: 'üè∫', cost: 5300, minValue: 4800, maxValue: 8500, rarity: 'Divine' },
        { id: 'olympus', name: 'Mount Olympus', emoji: '‚õ∞Ô∏è', cost: 5500, minValue: 5000, maxValue: 9000, rarity: 'Divine' },
        
        { id: 'ninja', name: 'Ninja Star', emoji: '‚≠ê', cost: 1600, minValue: 1100, maxValue: 2700, rarity: 'Epic' },
        { id: 'samurai', name: 'Samurai Soul', emoji: 'üéå', cost: 2400, minValue: 1900, maxValue: 3900, rarity: 'Legendary' },
        { id: 'pirate', name: 'Pirate Treasure', emoji: '‚ò†Ô∏è', cost: 2100, minValue: 1600, maxValue: 3600, rarity: 'Legendary' },
        { id: 'wizard', name: 'Wizard Hat', emoji: 'üé©', cost: 1900, minValue: 1400, maxValue: 3200, rarity: 'Epic' },
        { id: 'mermaid', name: 'Mermaid Scale', emoji: 'üßú', cost: 2200, minValue: 1700, maxValue: 3700, rarity: 'Legendary' },
        { id: 'vampire', name: 'Vampire Fang', emoji: 'üßõ', cost: 1800, minValue: 1300, maxValue: 3000, rarity: 'Epic' },
        { id: 'zombie', name: 'Zombie Brain', emoji: 'üßü', cost: 1400, minValue: 1000, maxValue: 2300, rarity: 'Rare' },
        { id: 'ghost', name: 'Ghost Spirit', emoji: 'üëª', cost: 1500, minValue: 1000, maxValue: 2500, rarity: 'Rare' },
        { id: 'skeleton', name: 'Skeleton Key', emoji: 'üíÄ', cost: 1700, minValue: 1200, maxValue: 2900, rarity: 'Epic' },
        { id: 'devil', name: 'Devil Horns', emoji: 'üòà', cost: 2000, minValue: 1500, maxValue: 3300, rarity: 'Epic' },
        { id: 'angel', name: 'Angel Wings', emoji: 'üòá', cost: 2300, minValue: 1800, maxValue: 3800, rarity: 'Legendary' },
        { id: 'clown', name: 'Clown Nose', emoji: 'ü§°', cost: 800, minValue: 500, maxValue: 1300, rarity: 'Common' },
        { id: 'alien2', name: 'Alien Eye', emoji: 'üëæ', cost: 1600, minValue: 1100, maxValue: 2700, rarity: 'Epic' },
        { id: 'robot2', name: 'Robot Arm', emoji: 'ü¶æ', cost: 1500, minValue: 1000, maxValue: 2500, rarity: 'Rare' },
        { id: 'brain', name: 'Big Brain', emoji: 'üß†', cost: 1800, minValue: 1300, maxValue: 3000, rarity: 'Epic' },
        { id: 'eyeball', name: 'All Seeing Eye', emoji: 'üëÅÔ∏è', cost: 2000, minValue: 1500, maxValue: 3300, rarity: 'Epic' },
        { id: 'tooth', name: 'Golden Tooth', emoji: 'ü¶∑', cost: 900, minValue: 600, maxValue: 1500, rarity: 'Common' },
        { id: 'bone', name: 'Dino Bone', emoji: 'ü¶¥', cost: 1100, minValue: 700, maxValue: 1850, rarity: 'Rare' },
        { id: 'ear', name: 'Elf Ear', emoji: 'üëÇ', cost: 700, minValue: 450, maxValue: 1200, rarity: 'Common' },
        { id: 'nose', name: 'Red Nose', emoji: 'üëÉ', cost: 600, minValue: 350, maxValue: 1000, rarity: 'Common' },
        { id: 'lips', name: 'Kiss Lips', emoji: 'üíã', cost: 950, minValue: 625, maxValue: 1600, rarity: 'Common' },
        { id: 'footprint', name: 'Bigfoot Print', emoji: 'üë£', cost: 1300, minValue: 900, maxValue: 2200, rarity: 'Rare' },
        { id: 'snowman', name: 'Snowman', emoji: '‚õÑ', cost: 1200, minValue: 800, maxValue: 2000, rarity: 'Rare' },
        { id: 'santa', name: 'Santa Hat', emoji: 'üéÖ', cost: 1400, minValue: 1000, maxValue: 2300, rarity: 'Rare' },
        { id: 'elf', name: 'Elf Helper', emoji: 'üßù', cost: 1100, minValue: 700, maxValue: 1850, rarity: 'Rare' },
        { id: 'fairy', name: 'Fairy Dust', emoji: 'üßö', cost: 1600, minValue: 1100, maxValue: 2700, rarity: 'Epic' },
        { id: 'genie', name: 'Genie Lamp', emoji: 'üßû', cost: 2500, minValue: 2000, maxValue: 4000, rarity: 'Legendary' },
        { id: 'superhero', name: 'Superhero Cape', emoji: 'ü¶∏', cost: 2100, minValue: 1600, maxValue: 3600, rarity: 'Legendary' },
        { id: 'villain', name: 'Villain Mask', emoji: 'ü¶π', cost: 1900, minValue: 1400, maxValue: 3200, rarity: 'Epic' },
        { id: 'detective', name: 'Detective Badge', emoji: 'üïµÔ∏è', cost: 1300, minValue: 900, maxValue: 2200, rarity: 'Rare' },
        { id: 'guard', name: 'Royal Guard', emoji: 'üíÇ', cost: 1500, minValue: 1000, maxValue: 2500, rarity: 'Rare' },
        { id: 'construction', name: 'Hard Hat', emoji: 'üë∑', cost: 800, minValue: 500, maxValue: 1300, rarity: 'Common' },
        { id: 'chef', name: 'Chef Hat', emoji: 'üë®‚Äçüç≥', cost: 900, minValue: 600, maxValue: 1500, rarity: 'Common' },
        { id: 'scientist', name: 'Lab Coat', emoji: 'üë®‚Äçüî¨', cost: 1200, minValue: 800, maxValue: 2000, rarity: 'Rare' },
        { id: 'astronaut', name: 'Space Suit', emoji: 'üë®‚ÄçüöÄ', cost: 2800, minValue: 2200, maxValue: 4500, rarity: 'Legendary' },
        { id: 'firefighter', name: 'Fire Helmet', emoji: 'üë®‚Äçüöí', cost: 1400, minValue: 1000, maxValue: 2300, rarity: 'Rare' },
        { id: 'pilot', name: 'Pilot Wings', emoji: 'üë®‚Äç‚úàÔ∏è', cost: 1600, minValue: 1100, maxValue: 2700, rarity: 'Epic' },
        { id: 'artist', name: 'Artist Palette', emoji: 'üë®‚Äçüé®', cost: 1100, minValue: 700, maxValue: 1850, rarity: 'Rare' },
        { id: 'singer', name: 'Microphone', emoji: 'üë®‚Äçüé§', cost: 1300, minValue: 900, maxValue: 2200, rarity: 'Rare' },
        { id: 'teacher', name: 'Graduation Cap', emoji: 'üë®‚Äçüè´', cost: 1000, minValue: 650, maxValue: 1700, rarity: 'Rare' },
        { id: 'factory', name: 'Factory Worker', emoji: 'üë®‚Äçüè≠', cost: 750, minValue: 450, maxValue: 1250, rarity: 'Common' },
        { id: 'technologist', name: 'Tech Expert', emoji: 'üë®‚Äçüíª', cost: 1500, minValue: 1000, maxValue: 2500, rarity: 'Rare' },
        { id: 'office', name: 'Office Worker', emoji: 'üë®‚Äçüíº', cost: 900, minValue: 600, maxValue: 1500, rarity: 'Common' },
        { id: 'mechanic', name: 'Mechanic Tool', emoji: 'üë®‚Äçüîß', cost: 950, minValue: 600, maxValue: 1600, rarity: 'Common' },
        { id: 'farmer', name: 'Farming Tool', emoji: 'üë®‚Äçüåæ', cost: 800, minValue: 500, maxValue: 1300, rarity: 'Common' },
        { id: 'cook', name: 'Cooking Pot', emoji: 'üë®‚Äçüç≥', cost: 850, minValue: 550, maxValue: 1400, rarity: 'Common' },
        { id: 'student', name: 'School Books', emoji: 'üë®‚Äçüéì', cost: 700, minValue: 450, maxValue: 1200, rarity: 'Common' },
        { id: 'singer2', name: 'Rock Star', emoji: 'üé§', cost: 1700, minValue: 1200, maxValue: 2900, rarity: 'Epic' },
        { id: 'guitar', name: 'Electric Guitar', emoji: 'üé∏', cost: 1500, minValue: 1000, maxValue: 2500, rarity: 'Rare' },
        { id: 'piano', name: 'Grand Piano', emoji: 'üéπ', cost: 2000, minValue: 1500, maxValue: 3300, rarity: 'Epic' },
        { id: 'drum', name: 'Drum Set', emoji: 'ü•Å', cost: 1400, minValue: 1000, maxValue: 2300, rarity: 'Rare' },
        { id: 'saxophone', name: 'Golden Sax', emoji: 'üé∑', cost: 1800, minValue: 1300, maxValue: 3000, rarity: 'Epic' },
        { id: 'trumpet', name: 'Trumpet', emoji: 'üé∫', cost: 1300, minValue: 900, maxValue: 2200, rarity: 'Rare' },
        { id: 'violin', name: 'Violin', emoji: 'üéª', cost: 1900, minValue: 1400, maxValue: 3200, rarity: 'Epic' },
        { id: 'banjo', name: 'Banjo', emoji: 'ü™ï', cost: 1100, minValue: 700, maxValue: 1850, rarity: 'Rare' },
        { id: 'accordion', name: 'Accordion', emoji: 'ü™ó', cost: 1200, minValue: 800, maxValue: 2000, rarity: 'Rare' },
        { id: 'flute', name: 'Magic Flute', emoji: 'üéµ', cost: 1000, minValue: 650, maxValue: 1700, rarity: 'Rare' },
        { id: 'headphones', name: 'DJ Headphones', emoji: 'üéß', cost: 950, minValue: 600, maxValue: 1600, rarity: 'Common' },
        { id: 'radio', name: 'Vintage Radio', emoji: 'üìª', cost: 850, minValue: 550, maxValue: 1400, rarity: 'Common' },
        { id: 'tv', name: 'Retro TV', emoji: 'üì∫', cost: 1100, minValue: 700, maxValue: 1850, rarity: 'Rare' },
        { id: 'megaphone', name: 'Megaphone', emoji: 'üì£', cost: 800, minValue: 500, maxValue: 1300, rarity: 'Common' },
        { id: 'loudspeaker', name: 'Loudspeaker', emoji: 'üì¢', cost: 900, minValue: 600, maxValue: 1500, rarity: 'Common' },
        { id: 'bell', name: 'Golden Bell', emoji: 'üîî', cost: 1200, minValue: 800, maxValue: 2000, rarity: 'Rare' },
        { id: 'hourglass', name: 'Time Glass', emoji: '‚è≥', cost: 1600, minValue: 1100, maxValue: 2700, rarity: 'Epic' },
        { id: 'alarm', name: 'Alarm Clock', emoji: '‚è∞', cost: 700, minValue: 450, maxValue: 1200, rarity: 'Common' },
        { id: 'stopwatch', name: 'Stopwatch', emoji: '‚è±Ô∏è', cost: 800, minValue: 500, maxValue: 1300, rarity: 'Common' },
        { id: 'timer', name: 'Kitchen Timer', emoji: '‚è≤Ô∏è', cost: 600, minValue: 350, maxValue: 1000, rarity: 'Common' },
        { id: 'compass', name: 'Explorer Compass', emoji: 'üß≠', cost: 1300, minValue: 900, maxValue: 2200, rarity: 'Rare' },
        { id: 'gear', name: 'Golden Gear', emoji: '‚öôÔ∏è', cost: 950, minValue: 625, maxValue: 1600, rarity: 'Common' },
        { id: 'anchor', name: 'Ship Anchor', emoji: '‚öì', cost: 1400, minValue: 1000, maxValue: 2300, rarity: 'Rare' },
        { id: 'plane', name: 'Airplane', emoji: '‚úàÔ∏è', cost: 2500, minValue: 2000, maxValue: 4000, rarity: 'Legendary' },
        { id: 'helicopter', name: 'Helicopter', emoji: 'üöÅ', cost: 2400, minValue: 1900, maxValue: 3900, rarity: 'Legendary' },
        { id: 'boat', name: 'Speed Boat', emoji: 'üö§', cost: 1800, minValue: 1300, maxValue: 3000, rarity: 'Epic' },
        { id: 'train', name: 'Train Engine', emoji: 'üöÇ', cost: 2000, minValue: 1500, maxValue: 3300, rarity: 'Epic' },
        { id: 'racecar', name: 'Race Car', emoji: 'üèéÔ∏è', cost: 2200, minValue: 1700, maxValue: 3700, rarity: 'Legendary' },
        { id: 'motorcycle', name: 'Motorcycle', emoji: 'üèçÔ∏è', cost: 1700, minValue: 1200, maxValue: 2900, rarity: 'Epic' },
        { id: 'scooter', name: 'Electric Scooter', emoji: 'üõ¥', cost: 900, minValue: 600, maxValue: 1500, rarity: 'Common' },
        { id: 'skateboard', name: 'Skateboard', emoji: 'üõπ', cost: 800, minValue: 500, maxValue: 1300, rarity: 'Common' },
        { id: 'parachute', name: 'Parachute', emoji: 'ü™Ç', cost: 1500, minValue: 1000, maxValue: 2500, rarity: 'Rare' },
        { id: 'kite', name: 'Flying Kite', emoji: 'ü™Å', cost: 600, minValue: 350, maxValue: 1000, rarity: 'Common' },
        { id: 'magnet', name: 'Super Magnet', emoji: 'üß≤', cost: 1100, minValue: 700, maxValue: 1850, rarity: 'Rare' },
        { id: 'flashlight', name: 'Flashlight', emoji: 'üî¶', cost: 700, minValue: 450, maxValue: 1200, rarity: 'Common' },
        { id: 'candle', name: 'Magic Candle', emoji: 'üïØÔ∏è', cost: 950, minValue: 625, maxValue: 1600, rarity: 'Common' },
        { id: 'bulb', name: 'Light Bulb', emoji: 'üí°', cost: 850, minValue: 550, maxValue: 1400, rarity: 'Common' },
        { id: 'book', name: 'Ancient Book', emoji: 'üìñ', cost: 1300, minValue: 900, maxValue: 2200, rarity: 'Rare' },
        { id: 'scroll', name: 'Sacred Scroll', emoji: 'üìú', cost: 1600, minValue: 1100, maxValue: 2700, rarity: 'Epic' },
        { id: 'pen', name: 'Golden Pen', emoji: '‚úíÔ∏è', cost: 900, minValue: 600, maxValue: 1500, rarity: 'Common' },
        { id: 'pencil', name: 'Magic Pencil', emoji: '‚úèÔ∏è', cost: 700, minValue: 450, maxValue: 1200, rarity: 'Common' },
        { id: 'briefcase', name: 'Briefcase', emoji: 'üíº', cost: 1200, minValue: 800, maxValue: 2000, rarity: 'Rare' },
        { id: 'purse', name: 'Designer Purse', emoji: 'üëõ', cost: 1500, minValue: 1000, maxValue: 2500, rarity: 'Rare' }
    ];

    const [money, setMoney] = useState(1000);
    const [username, setUsername] = useState('Player');
    const [portfolio, setPortfolio] = useState({});
    const [limitedInventory, setLimitedInventory] = useState({});
    const [tradeHistory, setTradeHistory] = useState([]);
    
    // Load initial state from window.gameState
    useEffect(() => {
        if (window.gameState) {
            console.log('üîÑ Loading state from window.gameState:', window.gameState);
            setUsername(window.gameState.username || 'Player');
            setMoney(window.gameState.money || 1000);
            setPortfolio(window.gameState.portfolio || {});
            setLimitedInventory(window.gameState.limitedInventory || {});
            setTradeHistory(window.gameState.tradeHistory || []);
        }
        
        // Set up an interval to check for updates from window.gameState
        const syncInterval = setInterval(() => {
            if (window.gameState && window.gameState.username !== username) {
                console.log('üîÑ Syncing username:', window.gameState.username);
                setUsername(window.gameState.username);
                setMoney(window.gameState.money);
                setPortfolio(window.gameState.portfolio);
                setLimitedInventory(window.gameState.limitedInventory);
                setTradeHistory(window.gameState.tradeHistory);
            }
        }, 1000);
        
        return () => clearInterval(syncInterval);
    }, []);
    
    // PRICES FROM FIREBASE
    const [prices, setPrices] = useState({});
    const [limitedValues, setLimitedValues] = useState({});
    const [priceHistory, setPriceHistory] = useState([]);
    const [nextUpdateTime, setNextUpdateTime] = useState(null);
    const [updateCount, setUpdateCount] = useState(0);
    const [showUpdateNotice, setShowUpdateNotice] = useState(false);
    
    const [marketOpen, setMarketOpen] = useState(isMarketOpen());
    const [timeUntilChange, setTimeUntilChange] = useState(getTimeUntilMarketChange());
    const [timeUntilPriceUpdate, setTimeUntilPriceUpdate] = useState(120);
    
    const [currentView, setCurrentView] = useState('market');
    const [limitedFilter, setLimitedFilter] = useState('all');
    const [selectedBaby, setSelectedBaby] = useState(null);
    const [selectedLimited, setSelectedLimited] = useState(null);
    
    const [leaderboard, setLeaderboard] = useState([]);
    const [tradeAds, setTradeAds] = useState([]);
    const [tradeOffers, setTradeOffers] = useState([]);
    const [showTradeForm, setShowTradeForm] = useState(false);
    const [tradeAdType, setTradeAdType] = useState('upgrade');
    const [tradeAdDesc, setTradeAdDesc] = useState('');
    const [tradeAdOffering, setTradeAdOffering] = useState('');
    const [tradeAdLooking, setTradeAdLooking] = useState('');
    
    const [pricesLoaded, setPricesLoaded] = useState(false);
    const [isUpdating, setIsUpdating] = useState(false);
    
    const previousPricesRef = useRef({});
    const babyChartRef = useRef(null);
    const limitedChartRef = useRef(null);
    const netWorthChartRef = useRef(null);

    // ===================================
    // LOAD GLOBAL PRICES FROM FIREBASE
    // ===================================
    
    useEffect(() => {
        console.log('üî• Initializing GLOBAL PRICE SYNC (2-MINUTE UPDATES)...');
        
        // Initialize prices if needed
        window.multiplayer.initializeGlobalPrices(babies.map(b => b.id), limitedItems);
        
        // Listen to real-time price updates
        const unsubscribe = window.multiplayer.listenToGlobalPrices((priceData) => {
            console.log('üìä Got price update from Firebase! Update #', priceData.updateCount);
            
            // Store previous prices for comparison
            previousPricesRef.current = { ...prices };
            
            setPrices(priceData.babyPrices);
            setLimitedValues(priceData.limitedValues);
            setPriceHistory(priceData.priceHistory || []);
            setNextUpdateTime(priceData.nextUpdateTime);
            setUpdateCount(priceData.updateCount);
            setPricesLoaded(true);
            
            // Show update notice
            if (priceData.updateCount > 0) {
                setShowUpdateNotice(true);
                setTimeout(() => setShowUpdateNotice(false), 5000);
            }
            
            // Update highest values
            const currentNetWorth = money + getPortfolioValue() + getLimitedValue();
            if (money > (window.gameState?.highestMoney || 0)) {
                window.gameState.highestMoney = money;
            }
            if (currentNetWorth > (window.gameState?.highestNetWorth || 0)) {
                window.gameState.highestNetWorth = currentNetWorth;
            }
        });
        
        return () => unsubscribe();
    }, []);
    
    // Price update countdown
    useEffect(() => {
        const countdown = setInterval(() => {
            if (nextUpdateTime) {
                const remaining = getTimeUntilNextPriceUpdate(nextUpdateTime);
                setTimeUntilPriceUpdate(remaining);
            }
        }, 1000);
        
        return () => clearInterval(countdown);
    }, [nextUpdateTime]);
    
    // Auto price update every 2 minutes
    useEffect(() => {
        if (!pricesLoaded) return;
        
        const priceUpdater = setInterval(() => {
            if (marketOpen) {
                console.log('‚è∞ 2 MINUTES PASSED! Auto-updating prices...');
                window.multiplayer.forceUpdateGlobalPrices(babies, limitedItems);
            }
        }, 2 * 60 * 1000);
        
        return () => clearInterval(priceUpdater);
    }, [marketOpen, pricesLoaded]);

    // Market status check
    useEffect(() => {
        const statusCheck = setInterval(() => {
            const nowOpen = isMarketOpen();
            if (nowOpen !== marketOpen) {
                setMarketOpen(nowOpen);
            }
            setTimeUntilChange(getTimeUntilMarketChange());
        }, 60000);

        return () => clearInterval(statusCheck);
    }, [marketOpen]);

    // Income timer
    useEffect(() => {
        const timer = setInterval(() => {
            setMoney(prev => {
                const newMoney = prev + 200;
                window.gameState.money = newMoney;
                console.log('üí∞ Income received! +$200. New balance:', newMoney);
                // Save on income update
                if (typeof saveGameData === 'function') {
                    saveGameData();
                }
                return newMoney;
            });
        }, 90000);
        return () => clearInterval(timer);
    }, []);

    const getPortfolioValue = () => {
        let total = 0;
        Object.keys(portfolio).forEach(id => {
            total += (portfolio[id] || 0) * (prices[id] || 0);
        });
        return Math.round(total * 100) / 100;
    };

    const getLimitedValue = () => {
        let total = 0;
        Object.keys(limitedInventory).forEach(itemId => {
            const count = limitedInventory[itemId]?.length || 0;
            total += count * (limitedValues[itemId] || 0);
        });
        return Math.round(total * 100) / 100;
    };
    
    const handleForceUpdate = async () => {
        if (isUpdating) return;
        
        setIsUpdating(true);
        console.log('üöÄ MANUAL FORCE UPDATE TRIGGERED!');
        
        const success = await window.multiplayer.forceUpdateGlobalPrices(babies, limitedItems);
        
        if (success) {
            alert('‚úÖ Prices updated successfully! Watch them change!');
        } else {
            alert('‚ùå Update failed. Check console for errors.');
        }
        
        setIsUpdating(false);
    };

    const buyBaby = (babyId, babyPrice) => {
        if (!marketOpen) {
            alert('Market is closed! Trading hours: 9 AM - 9 PM');
            return;
        }
        
        if (money >= babyPrice) {
            const newMoney = money - babyPrice;
            const newPortfolio = { ...portfolio, [babyId]: (portfolio[babyId] || 0) + 1 };
            
            const baby = babies.find(b => b.id === babyId);
            const newTrade = {
                id: Date.now(),
                type: 'BUY',
                babyName: baby.name,
                price: babyPrice,
                timestamp: new Date().toLocaleString()
            };
            const newTradeHistory = [newTrade, ...tradeHistory];
            
            // Update React state
            setMoney(newMoney);
            setPortfolio(newPortfolio);
            setTradeHistory(newTradeHistory);
            
            // Update window.gameState immediately
            window.gameState.money = newMoney;
            window.gameState.portfolio = newPortfolio;
            window.gameState.tradeHistory = newTradeHistory;
            
            // Save to Firebase immediately
            saveGameData();
            
            window.multiplayer.updateLeaderboard({
                username,
                money: newMoney,
                portfolioValue: getPortfolioValue(),
                limitedValue: getLimitedValue(),
                portfolio: newPortfolio,
                limitedInventory,
                tradeHistory: newTradeHistory
            });
        }
    };

    const sellBaby = (babyId, babyPrice) => {
        if (!marketOpen) {
            alert('Market is closed! Trading hours: 9 AM - 9 PM');
            return;
        }
        
        if (portfolio[babyId] && portfolio[babyId] > 0) {
            const newMoney = money + babyPrice;
            const newPortfolio = { ...portfolio, [babyId]: portfolio[babyId] - 1 };
            
            const baby = babies.find(b => b.id === babyId);
            const newTrade = {
                id: Date.now(),
                type: 'SELL',
                babyName: baby.name,
                price: babyPrice,
                timestamp: new Date().toLocaleString()
            };
            const newTradeHistory = [newTrade, ...tradeHistory];
            
            // Update React state
            setMoney(newMoney);
            setPortfolio(newPortfolio);
            setTradeHistory(newTradeHistory);
            
            // Update window.gameState immediately
            window.gameState.money = newMoney;
            window.gameState.portfolio = newPortfolio;
            window.gameState.tradeHistory = newTradeHistory;
            
            // Save to Firebase immediately
            saveGameData();
            
            window.multiplayer.updateLeaderboard({
                username,
                money: newMoney,
                portfolioValue: getPortfolioValue(),
                limitedValue: getLimitedValue(),
                portfolio: newPortfolio,
                limitedInventory,
                tradeHistory: newTradeHistory
            });
        }
    };

    const buyLimited = (itemId, itemCost) => {
        if (money >= itemCost) {
            const serialNumber = Date.now();
            const newMoney = money - itemCost;
            const newInventory = { 
                ...limitedInventory, 
                [itemId]: [...(limitedInventory[itemId] || []), { serial: serialNumber, purchaseDate: new Date().toISOString() }]
            };
            
            const item = limitedItems.find(i => i.id === itemId);
            const newTrade = {
                id: Date.now(),
                type: 'BUY_LIMITED',
                babyName: item.name + ' #' + serialNumber,
                price: itemCost,
                timestamp: new Date().toLocaleString()
            };
            const newTradeHistory = [newTrade, ...tradeHistory];
            
            // Update React state
            setMoney(newMoney);
            setLimitedInventory(newInventory);
            setTradeHistory(newTradeHistory);
            
            // Update window.gameState immediately
            window.gameState.money = newMoney;
            window.gameState.limitedInventory = newInventory;
            window.gameState.tradeHistory = newTradeHistory;
            
            // Save to Firebase immediately
            saveGameData();
        }
    };

    const sellLimited = (itemId, serialNumber, value) => {
        const newMoney = money + value;
        const newInventory = { 
            ...limitedInventory, 
            [itemId]: limitedInventory[itemId].filter(item => item.serial !== serialNumber)
        };
        
        const item = limitedItems.find(i => i.id === itemId);
        const newTrade = {
            id: Date.now(),
            type: 'SELL_LIMITED',
            babyName: item.name + ' #' + serialNumber,
            price: value,
            timestamp: new Date().toLocaleString()
        };
        const newTradeHistory = [newTrade, ...tradeHistory];
        
        // Update React state
        setMoney(newMoney);
        setLimitedInventory(newInventory);
        setTradeHistory(newTradeHistory);
        
        // Update window.gameState immediately
        window.gameState.money = newMoney;
        window.gameState.limitedInventory = newInventory;
        window.gameState.tradeHistory = newTradeHistory;
        
        // Save to Firebase immediately
        saveGameData();
    };

    // Load leaderboard
    useEffect(() => {
        if (currentView === 'leaderboard') {
            window.multiplayer.loadLeaderboard().then(setLeaderboard);
        }
    }, [currentView]);

    // Load trade ads and offers
    useEffect(() => {
        if (currentView === 'tradehub') {
            window.multiplayer.loadTradeAds().then(setTradeAds);
        } else if (currentView === 'trading') {
            window.multiplayer.loadMyTradeOffers().then(setTradeOffers);
        }
    }, [currentView]);

    const handlePostTrade = async () => {
        if (!tradeAdDesc || !tradeAdOffering || !tradeAdLooking) {
            alert('Please fill in all fields');
            return;
        }
        
        const adId = await window.multiplayer.postTradeAd({
            username,
            type: tradeAdType,
            description: tradeAdDesc,
            offering: tradeAdOffering,
            lookingFor: tradeAdLooking
        });
        
        if (adId) {
            alert('Trade ad posted successfully!');
            setShowTradeForm(false);
            setTradeAdDesc('');
            setTradeAdOffering('');
            setTradeAdLooking('');
            window.multiplayer.loadTradeAds().then(setTradeAds);
        }
    };

    const handleDeleteAd = async (adId) => {
        if (confirm('Delete this trade ad?')) {
            const success = await window.multiplayer.deleteTradeAd(adId);
            if (success) {
                window.multiplayer.loadTradeAds().then(setTradeAds);
            }
        }
    };
    
    const handleAcceptTrade = async (offerId) => {
        if (confirm('Accept this trade offer?')) {
            const success = await window.multiplayer.acceptTradeOffer(offerId);
            if (success) {
                alert('Trade accepted! Complete the exchange with the other player.');
                window.multiplayer.loadMyTradeOffers().then(setTradeOffers);
            }
        }
    };
    
    const handleRejectTrade = async (offerId) => {
        if (confirm('Reject this trade offer?')) {
            const success = await window.multiplayer.rejectTradeOffer(offerId);
            if (success) {
                window.multiplayer.loadMyTradeOffers().then(setTradeOffers);
            }
        }
    };
    
    const getFilteredLimiteds = () => {
        if (limitedFilter === 'all') return limitedItems;
        return limitedItems.filter(item => item.rarity.toLowerCase() === limitedFilter);
    };
    
    const getPriceChange = (babyId) => {
        const oldPrice = previousPricesRef.current[babyId];
        const newPrice = prices[babyId];
        
        if (!oldPrice || !newPrice || oldPrice === newPrice) return null;
        
        const change = ((newPrice - oldPrice) / oldPrice * 100).toFixed(1);
        return { direction: newPrice > oldPrice ? 'up' : 'down', percentage: Math.abs(change) };
    };

    // Create Charts for Profile
    useEffect(() => {
        if (currentView === 'profile' && priceHistory.length > 0) {
            // Baby Price Chart
            if (babyChartRef.current) {
                const ctx = babyChartRef.current.getContext('2d');
                if (window.babyChart) window.babyChart.destroy();
                
                const timestamps = priceHistory.map(p => new Date(p.timestamp).toLocaleTimeString());
                const babyData = babies.slice(0, 5).map(baby => ({
                    label: baby.name,
                    data: priceHistory.map(p => p.babyPrices[baby.id] || 0),
                    borderWidth: 2,
                    fill: false
                }));
                
                window.babyChart = new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: timestamps,
                        datasets: babyData
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: true,
                        plugins: {
                            legend: { display: true }
                        }
                    }
                });
            }
            
            // Net Worth Chart
            if (netWorthChartRef.current) {
                const ctx = netWorthChartRef.current.getContext('2d');
                if (window.netWorthChart) window.netWorthChart.destroy();
                
                const timestamps = priceHistory.map(p => new Date(p.timestamp).toLocaleTimeString());
                const netWorths = priceHistory.map(p => {
                    let total = money;
                    Object.keys(portfolio).forEach(id => {
                        total += (portfolio[id] || 0) * (p.babyPrices[id] || 0);
                    });
                    Object.keys(limitedInventory).forEach(id => {
                        const count = limitedInventory[id]?.length || 0;
                        total += count * (p.limitedValues[id] || 0);
                    });
                    return total;
                });
                
                window.netWorthChart = new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: timestamps,
                        datasets: [{
                            label: 'Net Worth',
                            data: netWorths,
                            borderColor: '#3498db',
                            backgroundColor: 'rgba(52, 152, 219, 0.1)',
                            borderWidth: 3,
                            fill: true
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: true,
                        plugins: {
                            legend: { display: false }
                        }
                    }
                });
            }
        }
    }, [currentView, priceHistory, portfolio, limitedInventory, money]);

    if (!pricesLoaded) {
        return (
            <div style={{ padding: '40px', textAlign: 'center' }}>
                <div className="loading-spinner"></div>
                <h2>Loading global prices...</h2>
                <p>Connecting to Firebase...</p>
            </div>
        );
    }

    return (
        <div style={{ display: 'flex' }}>
            <div className="sidebar">
                <h2>üí∞ Aurababy Market</h2>
                
                <div className="sidebar-stats">
                    <div><strong>User:</strong><br/>{username}</div>
                    <div><strong>Cash:</strong><br/>${money.toLocaleString()}</div>
                    <div><strong>Babies:</strong><br/>${getPortfolioValue().toLocaleString()}</div>
                    <div><strong>Limiteds:</strong><br/>${getLimitedValue().toLocaleString()}</div>
                    <div><strong>Net Worth:</strong><br/>${(money + getPortfolioValue() + getLimitedValue()).toLocaleString()}</div>
                    
                    <div className="sidebar-timer">
                        <strong>Market Status:</strong><br/>
                        {marketOpen ? 
                            <span style={{color: '#27ae60'}}>üü¢ OPEN</span> : 
                            <span style={{color: '#e74c3c'}}>üî¥ CLOSED</span>
                        }
                        <br/>
                        <small>{marketOpen ? 'Closes' : 'Opens'} in: {formatTime(timeUntilChange)}</small>
                        <br/><br/>
                        <strong>Next Auto-Update:</strong><br/>
                        <span style={{color: '#3498db', fontSize: '16px'}}>{formatTime(timeUntilPriceUpdate)}</span>
                        <br/>
                        <small style={{color: '#27ae60'}}>Updates: {updateCount}</small>
                    </div>
                </div>

                <button onClick={() => setCurrentView('market')} 
                    className={`nav-button ${currentView === 'market' ? 'active' : ''}`}>
                    üè™ Baby Market
                </button>
                <button onClick={() => setCurrentView('limited')} 
                    className={`nav-button ${currentView === 'limited' ? 'active' : ''}`}>
                    üíé Limited Store ({limitedItems.length})
                </button>
                <button onClick={() => setCurrentView('portfolio')} 
                    className={`nav-button ${currentView === 'portfolio' ? 'active' : ''}`}>
                    üìä Portfolio
                </button>
                <button onClick={() => setCurrentView('profile')} 
                    className={`nav-button ${currentView === 'profile' ? 'active' : ''}`}>
                    üë§ Profile & Stats
                </button>
                <button onClick={() => setCurrentView('trading')} 
                    className={`nav-button ${currentView === 'trading' ? 'active' : ''}`}>
                    üîÑ Trade Offers ({tradeOffers.length})
                </button>
                <button onClick={() => setCurrentView('trades')} 
                    className={`nav-button ${currentView === 'trades' ? 'active' : ''}`}>
                    üìú History ({tradeHistory.length})
                </button>
                <button onClick={() => setCurrentView('leaderboard')} 
                    className={`nav-button ${currentView === 'leaderboard' ? 'active' : ''}`}>
                    üèÜ Leaderboard
                </button>
                <button onClick={() => setCurrentView('tradehub')} 
                    className={`nav-button ${currentView === 'tradehub' ? 'active' : ''}`}>
                    ü§ù Trade Hub
                </button>
                
                <button onClick={logoutUser} className="nav-button logout-button">
                    üö™ Logout
                </button>
                
                <div className="sidebar-footer">
                    TEST MODE: 2-min updates<br/>
                    Market: 9 AM - 9 PM<br/>
                    {limitedItems.length} Limited Items!
                </div>
            </div>

            <div className="main-content">
                {showUpdateNotice && (
                    <div className="update-notice">
                        üî• PRICES JUST UPDATED! Update #{updateCount} - Watch for changes! üìàüìâ
                    </div>
                )}
                
                {currentView === 'market' && (
                    <div>
                        <h1 className="view-title">üè™ Baby Market</h1>
                        
                        {marketOpen ? (
                            <div className="market-open-banner">
                                ‚úÖ Market Open | Auto-update in: {formatTime(timeUntilPriceUpdate)} | Updates: {updateCount}
                            </div>
                        ) : (
                            <div className="market-closed-banner">
                                ‚ùå Market Closed | Opens in: {formatTime(timeUntilChange)} | Trading Hours: 9 AM - 9 PM
                            </div>
                        )}
                        
                        <button onClick={handleForceUpdate} disabled={isUpdating} className="force-update-button">
                            {isUpdating ? '‚è≥ UPDATING PRICES...' : 'üöÄ FORCE UPDATE PRICES NOW!'}
                        </button>
                        
                        <div className="card-grid">
                            {babies.map(baby => {
                                const price = prices[baby.id] || 150;
                                const owned = portfolio[baby.id] || 0;
                                const priceChange = getPriceChange(baby.id);
                                
                                return (
                                    <div key={baby.id} className={`card ${priceChange ? 'price-changed' : ''}`} onClick={() => setSelectedBaby(baby)}>
                                        {priceChange && (
                                            <div className={`price-change-badge price-change-${priceChange.direction}`}>
                                                {priceChange.direction === 'up' ? 'üìà' : 'üìâ'} {priceChange.percentage}%
                                            </div>
                                        )}
                                        <img src={baby.image} alt={baby.name} />
                                        <h3>{baby.name}</h3>
                                        <div className={`card-price ${priceChange ? `price-${priceChange.direction}` : ''}`}>
                                            ${price.toFixed(2)}
                                        </div>
                                        {owned > 0 && <div className="card-info" style={{color:'blue'}}>You own: {owned}</div>}
                                        <button onClick={(e) => { e.stopPropagation(); buyBaby(baby.id, price); }}
                                            disabled={money < price || !marketOpen} 
                                            className="card-button buy-button">
                                            {marketOpen ? `BUY $${price.toFixed(2)}` : 'CLOSED'}
                                        </button>
                                    </div>
                                );
                            })}
                        </div>
                    </div>
                )}

                {currentView === 'limited' && (
                    <div>
                        <h1 className="view-title">üíé Limited Edition Store</h1>
                        <p className="view-subtitle">{limitedItems.length} unique items! 8 DIVINE rarities! Serial numbers on all!</p>
                        
                        <div className="tabs">
                            <button onClick={() => setLimitedFilter('all')} className={`tab-button ${limitedFilter === 'all' ? 'active' : ''}`}>
                                All ({limitedItems.length})
                            </button>
                            <button onClick={() => setLimitedFilter('common')} className={`tab-button ${limitedFilter === 'common' ? 'active' : ''}`}>
                                Common ({limitedItems.filter(i => i.rarity === 'Common').length})
                            </button>
                            <button onClick={() => setLimitedFilter('rare')} className={`tab-button ${limitedFilter === 'rare' ? 'active' : ''}`}>
                                Rare ({limitedItems.filter(i => i.rarity === 'Rare').length})
                            </button>
                            <button onClick={() => setLimitedFilter('epic')} className={`tab-button ${limitedFilter === 'epic' ? 'active' : ''}`}>
                                Epic ({limitedItems.filter(i => i.rarity === 'Epic').length})
                            </button>
                            <button onClick={() => setLimitedFilter('legendary')} className={`tab-button ${limitedFilter === 'legendary' ? 'active' : ''}`}>
                                Legendary ({limitedItems.filter(i => i.rarity === 'Legendary').length})
                            </button>
                            <button onClick={() => setLimitedFilter('divine')} className={`tab-button ${limitedFilter === 'divine' ? 'active' : ''}`}>
                                üåü DIVINE üåü ({limitedItems.filter(i => i.rarity === 'Divine').length})
                            </button>
                        </div>
                        
                        <div className="card-grid">
                            {getFilteredLimiteds().map(item => {
                                const owned = limitedInventory[item.id]?.length || 0;
                                const value = limitedValues[item.id] || (item.minValue + item.maxValue) / 2;
                                
                                return (
                                    <div key={item.id} className={`card limited-card rarity-${item.rarity.toLowerCase()}`} onClick={() => setSelectedLimited(item)}>
                                        <div className={`limited-tier-badge rarity-${item.rarity.toLowerCase()}`}>{item.rarity}</div>
                                        <div className="limited-emoji">{item.emoji}</div>
                                        <h3>{item.name}</h3>
                                        <div className="limited-info">
                                            <div style={{fontSize: '14px'}}>Cost: ${item.cost}</div>
                                            <div style={{fontSize: '14px'}}>Value: ${value.toFixed(2)}</div>
                                            <div style={{fontSize: '12px', marginTop: '5px'}}>Range: ${item.minValue}-${item.maxValue}</div>
                                        </div>
                                        {owned > 0 && <div style={{textAlign: 'center', marginTop: '10px'}}>You own: {owned}</div>}
                                        <button onClick={(e) => { e.stopPropagation(); buyLimited(item.id, item.cost); }}
                                            disabled={money < item.cost} 
                                            className="card-button buy-button">
                                            BUY ${item.cost}
                                        </button>
                                    </div>
                                );
                            })}
                        </div>
                    </div>
                )}

                {currentView === 'portfolio' && (
                    <div>
                        <h1 className="view-title">üìä Your Portfolio</h1>
                        
                        <h2 className="mt-30">Babies</h2>
                        {Object.keys(portfolio).some(id => portfolio[id] > 0) ? (
                            <div className="card-grid">
                                {babies.map(baby => {
                                    const quantity = portfolio[baby.id] || 0;
                                    if (quantity === 0) return null;
                                    const currentPrice = prices[baby.id] || 150;
                                    
                                    return (
                                        <div key={baby.id} className="card">
                                            <img src={baby.image} alt={baby.name} />
                                            <h3>{baby.name}</h3>
                                            <div><strong>Quantity:</strong> {quantity}</div>
                                            <div className="card-price">${(quantity * currentPrice).toFixed(2)}</div>
                                            <div style={{fontSize: '14px', color: '#7f8c8d'}}>Each: ${currentPrice.toFixed(2)}</div>
                                            <button onClick={() => sellBaby(baby.id, currentPrice)} 
                                                disabled={!marketOpen}
                                                className="card-button sell-button">
                                                {marketOpen ? `SELL $${currentPrice.toFixed(2)}` : 'CLOSED'}
                                            </button>
                                        </div>
                                    );
                                })}
                            </div>
                        ) : (
                            <p>No babies owned. Visit the Market!</p>
                        )}
                        
                        <h2 className="mt-30">Limited Items</h2>
                        {Object.keys(limitedInventory).some(id => limitedInventory[id]?.length > 0) ? (
                            <div className="card-grid">
                                {limitedItems.map(item => {
                                    const items = limitedInventory[item.id] || [];
                                    if (items.length === 0) return null;
                                    
                                    return items.map((owned, idx) => (
                                        <div key={`${item.id}-${idx}`} className={`card limited-card rarity-${item.rarity.toLowerCase()}`}>
                                            <div className={`limited-tier-badge rarity-${item.rarity.toLowerCase()}`}>{item.rarity}</div>
                                            <div className="limited-emoji">{item.emoji}</div>
                                            <h3>{item.name}</h3>
                                            <div className="limited-serial">
                                                Serial: #{owned.serial}
                                            </div>
                                            <div className="card-price">${(limitedValues[item.id] || 0).toFixed(2)}</div>
                                            <button onClick={() => sellLimited(item.id, owned.serial, limitedValues[item.id])} 
                                                className="card-button sell-button">
                                                SELL ${(limitedValues[item.id] || 0).toFixed(2)}
                                            </button>
                                        </div>
                                    ));
                                })}
                            </div>
                        ) : (
                            <p>No limited items owned. Visit the Limited Store!</p>
                        )}
                    </div>
                )}

                {currentView === 'profile' && (
                    <div>
                        <h1 className="view-title">üë§ Profile & Statistics</h1>
                        
                        <div className="profile-header">
                            <div className="profile-username">{username}</div>
                            <div className="profile-joined">Member since {new Date(window.gameState?.createdAt || Date.now()).toLocaleDateString()}</div>
                        </div>
                        
                        <div className="stats-grid">
                            <div className="stat-card">
                                <div className="stat-label">Current Cash</div>
                                <div className="stat-value">${money.toLocaleString()}</div>
                            </div>
                            <div className="stat-card">
                                <div className="stat-label">Highest Cash</div>
                                <div className="stat-value">${(window.gameState?.highestMoney || 0).toLocaleString()}</div>
                            </div>
                            <div className="stat-card">
                                <div className="stat-label">Current Net Worth</div>
                                <div className="stat-value">${(money + getPortfolioValue() + getLimitedValue()).toLocaleString()}</div>
                            </div>
                            <div className="stat-card">
                                <div className="stat-label">Highest Net Worth</div>
                                <div className="stat-value">${(window.gameState?.highestNetWorth || 0).toLocaleString()}</div>
                            </div>
                            <div className="stat-card">
                                <div className="stat-label">Total Trades</div>
                                <div className="stat-value">{tradeHistory.length}</div>
                            </div>
                            <div className="stat-card">
                                <div className="stat-label">Babies Owned</div>
                                <div className="stat-value">{Object.values(portfolio).reduce((sum, qty) => sum + qty, 0)}</div>
                            </div>
                            <div className="stat-card">
                                <div className="stat-label">Limiteds Owned</div>
                                <div className="stat-value">{Object.values(limitedInventory).reduce((sum, arr) => sum + arr.length, 0)}</div>
                            </div>
                            <div className="stat-card">
                                <div className="stat-label">Portfolio Value</div>
                                <div className="stat-value">${getPortfolioValue().toLocaleString()}</div>
                            </div>
                        </div>
                        
                        {priceHistory.length > 1 && (
                            <>
                                <div className="chart-container">
                                    <div className="chart-title">üìà Net Worth Over Time</div>
                                    <canvas ref={netWorthChartRef} height="80"></canvas>
                                </div>
                                
                                <div className="chart-container">
                                    <div className="chart-title">üë∂ Baby Prices (Top 5)</div>
                                    <canvas ref={babyChartRef} height="80"></canvas>
                                </div>
                            </>
                        )}
                    </div>
                )}

                {currentView === 'trading' && (
                    <div>
                        <h1 className="view-title">üîÑ Trade Offers</h1>
                        <p className="view-subtitle">Player-to-player trading (Coming soon - UI ready!)</p>
                        
                        {tradeOffers.length > 0 ? (
                            <div>
                                {tradeOffers.map(offer => (
                                    <div key={offer.id} className="trade-offer-card">
                                        <div className="trade-offer-header">
                                            <div>
                                                <strong>{offer.fromUsername}</strong> wants to trade with you
                                            </div>
                                            <div style={{fontSize: '12px', color: '#7f8c8d'}}>
                                                {new Date(offer.createdAt?.toDate ? offer.createdAt.toDate() : Date.now()).toLocaleString()}
                                            </div>
                                        </div>
                                        
                                        <div className="trade-offer-content">
                                            <div className="trade-side">
                                                <strong>They Offer:</strong>
                                                <div className="trade-item-list">
                                                    {offer.offering?.babies && Object.keys(offer.offering.babies).map(babyId => (
                                                        <div key={babyId} className="trade-item-entry">
                                                            {offer.offering.babies[babyId]}x {babies.find(b => b.id === parseInt(babyId))?.name}
                                                        </div>
                                                    ))}
                                                    {offer.offering?.limiteds?.map(serial => (
                                                        <div key={serial} className="trade-item-entry">
                                                            Limited #{serial}
                                                        </div>
                                                    ))}
                                                    {offer.offering?.cash > 0 && (
                                                        <div className="trade-item-entry">
                                                            ${offer.offering.cash}
                                                        </div>
                                                    )}
                                                </div>
                                            </div>
                                            
                                            <div className="trade-arrow">‚áÑ</div>
                                            
                                            <div className="trade-side">
                                                <strong>They Want:</strong>
                                                <div className="trade-item-list">
                                                    {offer.requesting?.babies && Object.keys(offer.requesting.babies).map(babyId => (
                                                        <div key={babyId} className="trade-item-entry">
                                                            {offer.requesting.babies[babyId]}x {babies.find(b => b.id === parseInt(babyId))?.name}
                                                        </div>
                                                    ))}
                                                    {offer.requesting?.limiteds?.map(serial => (
                                                        <div key={serial} className="trade-item-entry">
                                                            Limited #{serial}
                                                        </div>
                                                    ))}
                                                    {offer.requesting?.cash > 0 && (
                                                        <div className="trade-item-entry">
                                                            ${offer.requesting.cash}
                                                        </div>
                                                    )}
                                                </div>
                                            </div>
                                        </div>
                                        
                                        <div className="trade-ad-actions">
                                            <button onClick={() => handleAcceptTrade(offer.id)} className="card-button buy-button">
                                                ‚úÖ Accept Trade
                                            </button>
                                            <button onClick={() => handleRejectTrade(offer.id)} className="card-button sell-button">
                                                ‚ùå Reject
                                            </button>
                                        </div>
                                    </div>
                                ))}
                            </div>
                        ) : (
                            <div style={{textAlign: 'center', padding: '40px'}}>
                                <h3>No pending trade offers</h3>
                                <p>Check the Trade Hub to find players to trade with!</p>
                            </div>
                        )}
                    </div>
                )}

                {currentView === 'trades' && (
                    <div>
                        <h1 className="view-title">üìú Trade History</h1>
                        {tradeHistory.length > 0 ? (
                            <div>
                                {tradeHistory.slice(0, 50).map(trade => (
                                    <div key={trade.id} className={`trade-item ${trade.type.includes('SELL') ? 'trade-sell' : 'trade-buy'}`}>
                                        <div className="trade-info">
                                            <strong>{trade.type.replace('_', ' ')}</strong>: {trade.babyName}
                                            <div style={{ fontSize: '14px', color: '#666' }}>{trade.timestamp}</div>
                                        </div>
                                        <div className="trade-price">
                                            ${trade.price.toLocaleString()}
                                        </div>
                                    </div>
                                ))}
                            </div>
                        ) : (
                            <p>No trades yet. Start buying and selling!</p>
                        )}
                    </div>
                )}

                {currentView === 'leaderboard' && (
                    <div>
                        <h1 className="view-title">üèÜ Leaderboard - Top Traders</h1>
                        <p className="view-subtitle">Rankings by total net worth</p>
                        
                        {leaderboard.length > 0 ? (
                            <div className="leaderboard-table">
                                <table>
                                    <thead>
                                        <tr>
                                            <th>Rank</th>
                                            <th>Username</th>
                                            <th>Net Worth</th>
                                            <th>Babies</th>
                                            <th>Limiteds</th>
                                            <th>Trades</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {leaderboard.map((player, idx) => (
                                            <tr key={player.id} className={player.isCurrentUser ? 'leaderboard-highlight' : ''}>
                                                <td className="leaderboard-rank">#{idx + 1}</td>
                                                <td><strong>{player.username}</strong> {player.isCurrentUser && '(You)'}</td>
                                                <td>${player.netWorth?.toLocaleString() || 0}</td>
                                                <td>{player.babiesOwned || 0}</td>
                                                <td>{player.limitedsOwned || 0}</td>
                                                <td>{player.totalTrades || 0}</td>
                                            </tr>
                                        ))}
                                    </tbody>
                                </table>
                            </div>
                        ) : (
                            <p>Loading leaderboard...</p>
                        )}
                    </div>
                )}

                {currentView === 'tradehub' && (
                    <div>
                        <h1 className="view-title">ü§ù Trade Hub</h1>
                        <p className="view-subtitle">Post trade ads and find trading partners</p>
                        
                        <button onClick={() => setShowTradeForm(!showTradeForm)} className="form-button mb-20">
                            {showTradeForm ? 'Cancel' : 'üìù Post Trade Ad'}
                        </button>
                        
                        {showTradeForm && (
                            <div className="post-trade-form">
                                <h3>Post Trade Ad</h3>
                                
                                <div className="form-group">
                                    <label className="form-label">Trade Type</label>
                                    <select value={tradeAdType} onChange={(e) => setTradeAdType(e.target.value)} className="form-select">
                                        <option value="upgrade">Upgrade (Trading up)</option>
                                        <option value="downgrade">Downgrade (Trading down)</option>
                                        <option value="lf">Looking For</option>
                                        <option value="selling">Selling</option>
                                    </select>
                                </div>
                                
                                <div className="form-group">
                                    <label className="form-label">What You're Offering</label>
                                    <input type="text" value={tradeAdOffering} onChange={(e) => setTradeAdOffering(e.target.value)}
                                        className="form-input" placeholder="e.g., 3x Aurababy + Lucky Cat #12345" />
                                </div>
                                
                                <div className="form-group">
                                    <label className="form-label">What You're Looking For</label>
                                    <input type="text" value={tradeAdLooking} onChange={(e) => setTradeAdLooking(e.target.value)}
                                        className="form-input" placeholder="e.g., 1x Diamond Baby or 5 legendaries" />
                                </div>
                                
                                <div className="form-group">
                                    <label className="form-label">Additional Notes</label>
                                    <textarea value={tradeAdDesc} onChange={(e) => setTradeAdDesc(e.target.value)}
                                        className="form-textarea" placeholder="Any extra info about your trade..."></textarea>
                                </div>
                                
                                <button onClick={handlePostTrade} className="form-button">
                                    Post Trade Ad
                                </button>
                            </div>
                        )}
                        
                        <h3 className="mt-30">Active Trade Ads</h3>
                        {tradeAds.length > 0 ? (
                            <div>
                                {tradeAds.map(ad => (
                                    <div key={ad.id} className="trade-ad-card">
                                        <div className="trade-ad-header">
                                            <div>
                                                <strong>{ad.username}</strong>
                                                {ad.isMyAd && <span style={{marginLeft: '10px', color: '#3498db'}}>(Your Ad)</span>}
                                            </div>
                                            <span className={`trade-ad-type trade-type-${ad.type}`}>
                                                {ad.type.toUpperCase()}
                                            </span>
                                        </div>
                                        
                                        <div className="trade-ad-content">
                                            <div><strong>Offering:</strong> {ad.offering}</div>
                                            <div className="mt-10"><strong>Looking For:</strong> {ad.lookingFor}</div>
                                            {ad.description && <div className="mt-10"><strong>Notes:</strong> {ad.description}</div>}
                                        </div>
                                        
                                        <div className="trade-ad-actions">
                                            {ad.isMyAd ? (
                                                <button onClick={() => handleDeleteAd(ad.id)} className="card-button sell-button">
                                                    Delete Ad
                                                </button>
                                            ) : (
                                                <button className="card-button buy-button">
                                                    Contact Trader
                                                </button>
                                            )}
                                        </div>
                                    </div>
                                ))}
                            </div>
                        ) : (
                            <p>No active trade ads. Be the first to post!</p>
                        )}
                    </div>
                )}
            </div>

            {selectedBaby && (
                <div onClick={() => setSelectedBaby(null)} className="modal-overlay">
                    <div onClick={e => e.stopPropagation()} className="modal">
                        <img src={selectedBaby.image} alt={selectedBaby.name} 
                            style={{ width: '100%', maxHeight: '300px', objectFit: 'cover', borderRadius: '10px' }} />
                        <h2 className="mt-20">{selectedBaby.name}</h2>
                        <div className="card-price">${(prices[selectedBaby.id] || 150).toFixed(2)}</div>
                        <div className="mb-20">You own: {portfolio[selectedBaby.id] || 0}</div>
                        {!marketOpen && <div className="text-danger mb-20">‚ö†Ô∏è Market is closed</div>}
                        <div className="modal-buttons">
                            <button onClick={() => { buyBaby(selectedBaby.id, prices[selectedBaby.id]); setSelectedBaby(null); }}
                                disabled={money < prices[selectedBaby.id] || !marketOpen} 
                                className={`modal-button ${money >= prices[selectedBaby.id] && marketOpen ? 'modal-button-primary' : 'modal-button-cancel'}`}>
                                BUY ${(prices[selectedBaby.id] || 150).toFixed(2)}
                            </button>
                            {portfolio[selectedBaby.id] > 0 && (
                                <button onClick={() => { sellBaby(selectedBaby.id, prices[selectedBaby.id]); setSelectedBaby(null); }} 
                                    disabled={!marketOpen}
                                    className="modal-button modal-button-secondary">
                                    SELL ${(prices[selectedBaby.id] || 150).toFixed(2)}
                                </button>
                            )}
                        </div>
                        <button onClick={() => setSelectedBaby(null)} className="modal-button modal-button-cancel mt-20" style={{ width: '100%' }}>
                            Close
                        </button>
                    </div>
                </div>
            )}

            {selectedLimited && (
                <div onClick={() => setSelectedLimited(null)} className="modal-overlay">
                    <div onClick={e => e.stopPropagation()} className={`modal limited-card rarity-${selectedLimited.rarity.toLowerCase()}`} style={{maxWidth: '500px'}}>
                        <div className={`limited-tier-badge rarity-${selectedLimited.rarity.toLowerCase()}`}>{selectedLimited.rarity}</div>
                        <div className="limited-emoji">{selectedLimited.emoji}</div>
                        <h2 className="mt-20">{selectedLimited.name}</h2>
                        <div className="limited-info">
                            <div>Cost: ${selectedLimited.cost}</div>
                            <div>Current Value: ${(limitedValues[selectedLimited.id] || 0).toFixed(2)}</div>
                            <div style={{fontSize: '12px', marginTop: '5px'}}>Value Range: ${selectedLimited.minValue}-${selectedLimited.maxValue}</div>
                            <div style={{fontSize: '12px', marginTop: '10px'}}>You own: {limitedInventory[selectedLimited.id]?.length || 0}</div>
                        </div>
                        <button onClick={() => { buyLimited(selectedLimited.id, selectedLimited.cost); setSelectedLimited(null); }}
                            disabled={money < selectedLimited.cost} 
                            className={`modal-button ${money >= selectedLimited.cost ? 'modal-button-primary' : 'modal-button-cancel'}`}
                            style={{ width: '100%', marginTop: '20px' }}>
                            BUY ${selectedLimited.cost}
                        </button>
                        <button onClick={() => setSelectedLimited(null)} className="modal-button modal-button-cancel" style={{ width: '100%', marginTop: '10px' }}>
                            Close
                        </button>
                    </div>
                </div>
            )}
        </div>
    );
};

ReactDOM.render(<AurababyMarket />, document.getElementById('root'));
    </script>
</body>
</html>
